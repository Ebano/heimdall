<!doctype html><html lang=en><head><title>Mechanisms Overview</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="An open source Identity Aware Proxy and an Access Control Decision service for cloud native applications"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../../../favicon.ico></head><body><header class="navbar navbar-expand-md navbar-dark bg-dark sticky-top"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand text-white" href=../../../../../ style=font-weight:500;font-size:1.5rem>Heimdall</a>
<button class=navbar-toggler type=button data-bs-toggle=offcanvas data-bs-target=#mainMenuContent aria-controls=mainMenuContent aria-expanded=false aria-label="Open main menu">
<span class=navbar-toggler-icon></span></button><div class="offcanvas offcanvas-end bg-dark" tabindex=-1 id=mainMenuContent data-bs-scroll=true aria-labelledby=mainMenuContentLabel><div class=offcanvas-header><h5 class="offcanvas-title text-white" id=mainMenuContentLabel>Heimdall</h5><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class=offcanvas-body><ul class="navbar-nav flex-column flex-md-row"><li class=nav-item style=display:flex><a class='nav-link text-white' href=../../../../../docs/welcome style=align-self:center>Docs</a></li><li class=nav-item style=display:flex><a class='nav-link text-white' href=../../../../../openapi/ style=align-self:center>API</a></li><li class="nav-item dropdown" style=display:flex><a class='nav-link dropdown-toggle text-white' href=# id="Get Started-navbarDropdown" role=button data-bs-toggle=dropdown aria-expanded=false style=align-self:center>Get Started</a><ul class="dropdown-menu bg-dark" aria-labelledby="Get Started-navbarDropdown"><li><a class='dropdown-item text-white' href=../../../../../docs/getting_started/concepts/>Concepts</a></li><li><a class='dropdown-item text-white' href=../../../../../docs/getting_started/decision_service_quickstart/>Decision Service Quickstart</a></li><li><a class='dropdown-item text-white' href=../../../../../docs/getting_started/proxy_service_quickstart/>Proxy Service Quickstart</a></li></ul></li><li class="nav-item dropdown" style=display:flex><a class='nav-link dropdown-toggle text-white' href=# id="Integration Guides-navbarDropdown" role=button data-bs-toggle=dropdown aria-expanded=false style=align-self:center>Integration Guides</a><ul class="dropdown-menu bg-dark" aria-labelledby="Integration Guides-navbarDropdown"><li><a class='dropdown-item text-white' href=../../../../../docs/guides/contour/>Contour Integration</a></li><li><a class='dropdown-item text-white' href=../../../../../docs/guides/emissary/>Emissary Ingress Integration</a></li><li><a class='dropdown-item text-white' href=../../../../../docs/guides/envoy/>Envoy Integration</a></li><li><a class='dropdown-item text-white' href=../../../../../docs/guides/haproxy/>HAProxy Integration</a></li><li><a class='dropdown-item text-white' href=../../../../../docs/guides/opa/>Integration with OPA</a></li><li><a class='dropdown-item text-white' href=../../../../../docs/guides/nginx/>NGINX Integration</a></li><li><a class='dropdown-item text-white' href=../../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li></ul></li></ul><hr class="text-white-50 d-md-none"><ul class="navbar-nav flex-column ms-auto" style=align-self:center><doc-version-select class="nav-item dropdown" version-file=/heimdall/data.json current-version=v0.13.0-alpha current-page=/docs/configuration/rules/pipeline_mechanisms/overview/><button class="btn btn-dark dropdown-toggle me-4" data-bs-toggle=dropdown aria-expanded=false>
v0.13.0-alpha</button></doc-version-select></ul><ul class="navbar-nav flex-column"><li class="nav-item mb-1" style=display:flex><a class="nav-link text-white" style=align-self:center href=https://github.com/dadrus/heimdall><svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div></nav></header><nav class="navbar navbar-expand-lg bg-light" aria-label="Docs menu"><div class=container-xxl><div class="row container-fluid"><doc-search class="col-auto me-auto" index-file=/heimdall/v0.13.0-alpha/index.json path-prefix=/heimdall/v0.13.0-alpha><form id=docs-search tabindex=1 class="doks-search position-relative me-auto"><input id=search class="form-control search-bar" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=search-suggestions class="shadow bg-white rounded collapse search-results"></div></form></doc-search><button class="col-auto navbar-toggler" type=button data-bs-toggle=collapse data-bs-target=#docsMenuContent aria-controls=docsMenuContent aria-expanded=false aria-label="Open docs menu"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-arrow-down-up" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.5 15a.5.5.0 00.5-.5V2.707l3.146 3.147a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 10.708.708L11 2.707V14.5a.5.5.0 00.5.5zm-7-14a.5.5.0 01.5.5v11.793l3.146-3.147a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 01.708-.708L4 13.293V1.5a.5.5.0 01.5-.5z"/></svg></button></div><div class="row d-md-none"><div class="col-2 collapse navbar-collapse" id=docsMenuContent><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/welcome/>Welcome</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 aria-expanded=false>
Getting Started</button><div id=section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/getting_started/concepts/>Concepts</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/getting_started/decision_service_quickstart/>Decision Service Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/getting_started/proxy_service_quickstart/>Proxy Service Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/getting_started/configuration_introduction/>Configuration Introduction</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a aria-expanded=false>
Operations</button><div id=section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/operations/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/operations/cli/>CLI</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/operations/observability/>Observability</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/operations/security/>Security</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-63bf47d7b1e91548862e3da277e46e20a4b75401 aria-expanded=false>
Integration Guides</button><div id=section-63bf47d7b1e91548862e3da277e46e20a4b75401 class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/guides/contour/>Contour Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/emissary/>Emissary Ingress Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/envoy/>Envoy Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/haproxy/>HAProxy Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/opa/>Integration with OPA</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/nginx/>NGINX Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 aria-expanded=true>
Configuration</button><div id=section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 class="collapse show"><ul class="nav flex-column"><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-5cbd584046863bc7b753e57e8681a98a87f36f0f aria-expanded=false>
Services</button><div id=section-5cbd584046863bc7b753e57e8681a98a87f36f0f class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/services/decision/>Decision</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/services/proxy/>Proxy</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/services/management/>Management</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-e2397377af6d698b0fb66f53c47349a85bd2cb00 aria-expanded=false>
Observability</button><div id=section-e2397377af6d698b0fb66f53c47349a85bd2cb00 class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/observability/tracing/>Tracing</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/observability/profiling/>Runtime Profiling</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a aria-expanded=true>
Rules</button><div id=section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/overview/>Rules Overview</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-83ebcaaac1209f17a08fa17b9b1837aca7b222f7 aria-expanded=true>
Pipeline Mechanisms</button><div id=section-83ebcaaac1209f17a08fa17b9b1837aca7b222f7 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class="nav-link fw-bold" href=../../../../../docs/configuration/rules/pipeline_mechanisms/overview/>Mechanisms Overview</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/contextualizers/>Contextualizers</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/finalizers/>Finalizers</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/error_handlers/>Error Handlers</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/configuration/>Rule</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/default/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/providers/>Rule Providers</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/cryptographic_material/>Cryptographic Material</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-db1c784524e1b54011a95823026161f7c8517fe0 aria-expanded=false>
Reference</button><div id=section-db1c784524e1b54011a95823026161f7c8517fe0 class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/reference/types/>Configuration Types</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/reference/reference/>Static Configuration Reference</a></li></ul></div></li></ul></div></li></ul></div></div></div></nav><div class="container-xxl d-xxl-flex"><aside class="d-none d-md-block pe-4 pt-4 flex-xxl-shrink-0"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/welcome/>Welcome</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 aria-expanded=false>
Getting Started</button><div id=section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/getting_started/concepts/>Concepts</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/getting_started/decision_service_quickstart/>Decision Service Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/getting_started/proxy_service_quickstart/>Proxy Service Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/getting_started/configuration_introduction/>Configuration Introduction</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a aria-expanded=false>
Operations</button><div id=section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/operations/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/operations/cli/>CLI</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/operations/observability/>Observability</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/operations/security/>Security</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-63bf47d7b1e91548862e3da277e46e20a4b75401 aria-expanded=false>
Integration Guides</button><div id=section-63bf47d7b1e91548862e3da277e46e20a4b75401 class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/guides/contour/>Contour Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/emissary/>Emissary Ingress Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/envoy/>Envoy Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/haproxy/>HAProxy Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/opa/>Integration with OPA</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/nginx/>NGINX Integration</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 aria-expanded=true>
Configuration</button><div id=section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 class="collapse show"><ul class="nav flex-column"><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-5cbd584046863bc7b753e57e8681a98a87f36f0f aria-expanded=false>
Services</button><div id=section-5cbd584046863bc7b753e57e8681a98a87f36f0f class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/services/decision/>Decision</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/services/proxy/>Proxy</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/services/management/>Management</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-e2397377af6d698b0fb66f53c47349a85bd2cb00 aria-expanded=false>
Observability</button><div id=section-e2397377af6d698b0fb66f53c47349a85bd2cb00 class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/observability/tracing/>Tracing</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/observability/profiling/>Runtime Profiling</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a aria-expanded=true>
Rules</button><div id=section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/overview/>Rules Overview</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-83ebcaaac1209f17a08fa17b9b1837aca7b222f7 aria-expanded=true>
Pipeline Mechanisms</button><div id=section-83ebcaaac1209f17a08fa17b9b1837aca7b222f7 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class="nav-link fw-bold" href=../../../../../docs/configuration/rules/pipeline_mechanisms/overview/>Mechanisms Overview</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/contextualizers/>Contextualizers</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/finalizers/>Finalizers</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/pipeline_mechanisms/error_handlers/>Error Handlers</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/configuration/>Rule</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/default/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/rules/providers/>Rule Providers</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/cryptographic_material/>Cryptographic Material</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-db1c784524e1b54011a95823026161f7c8517fe0 aria-expanded=false>
Reference</button><div id=section-db1c784524e1b54011a95823026161f7c8517fe0 class=collapse><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/reference/types/>Configuration Types</a></li><li class=nav-item><a class=nav-link href=../../../../../docs/configuration/reference/reference/>Static Configuration Reference</a></li></ul></div></li></ul></div></li></ul></aside><main class="px-3 pt-4 flex-xxl-grow-0"><h1>Mechanisms Overview</h1><div><linkable-headline-area><div class=paragraph><p>All mechanisms supported by heimdall fall into following categories:</p></div><div class=ulist><ul><li><p><a href=../../../../../docs/configuration/rules/pipeline_mechanisms/authenticators/>Authenticators</a>, which inspect HTTP requests for presence of authentication objects, like e.g. the presence of a specific cookie. If such objects exist, authenticators verify the related authentication status and obtain information about the corresponding subject. A subject, could be a user who tries to use particular functionality of the upstream service, a machine (if you have machine-2-machine interaction), or something different. Authenticators ensure the subject is authenticated and the information available about it is valid.</p></li><li><p><a href=../../../../../docs/configuration/rules/pipeline_mechanisms/authorizers/>Authorizers</a>, which ensure that the subject obtained via an authenticator has the required permissions to submit the given HTTP request and thus to execute the corresponding logic in the upstream service. E.g. a specific endpoint of the upstream service might only be accessible to a "user" from the "admin" group, or to an HTTP request if a specific HTTP header is set.</p></li><li><p><a href=../../../../../docs/configuration/rules/pipeline_mechanisms/contextualizers/>Contextualizers</a>, which enrich the information about the subject obtained via an authenticator with further contextual information, required either by the upstream service itself or an authorizer. This can be handy if the actual authentication system doesn’t have all information about the subject (which is usually the case in microservice architectures), or if dynamic information about the subject, like the current location based on the IP address, is required.</p></li><li><p><a href=../../../../../docs/configuration/rules/pipeline_mechanisms/finalizers/>Finalizers</a>, which, as the name implies, finalize the execution of the pipeline and enrich the request with data such as subject information or authentication tokens required by the upstream service. The available options range from doing nothing, adding a simple header over a structured JWT, to driving specific protocols, e.g. to obtain a token required by the upstream service.</p></li><li><p><a href=../../../../../docs/configuration/rules/pipeline_mechanisms/error_handlers/>Error Handlers</a>, which are responsible for execution of logic if any of the mechanisms described above fail. These range from a simple error response to the client, which sent the request, to sophisticated ones, supporting complex logic and redirects.</p></li></ul></div><div class=sect1><h2 id=_general_configuration>General Configuration</h2><div class=sectionbody><div class=paragraph><p>All of the above said mechanisms must be configured in the <code>mechanisms</code> section of heimdall’s configuration. Only those mechanisms, which have been configured, can then be (re-)used by rules.</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>mechanisms</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>authenticators</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#e6db74>&lt;list of authenticators&gt;</span>
  <span style=color:#a6e22e>authorizers</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#e6db74>&lt;list of authorizers&gt;</span>
  <span style=color:#a6e22e>contextualizers</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#e6db74>&lt;list of contextualizers&gt;</span>
  <span style=color:#a6e22e>finalizers</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#e6db74>&lt;list of finalizers&gt;</span>
  <span style=color:#a6e22e>error_handlers</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#e6db74>&lt;list of error handlers&gt;</span></code></pre></div></div><div class=paragraph><p>Each mechanism configuration entry must contain at least the following properties:</p></div><div class=ulist><ul><li><p><code>id</code> - The unique identifier of the mechanism. Identifiers are used to reference the required mechanism within a rule. You can choose whatever identifier, you want. It is just a name. It must however be unique across all defined mechanisms of a particular mechanism category (like authenticator, authorizer, etc.).</p></li><li><p><code>type</code> - The specific type of the mechanism.</p></li></ul></div><div class=paragraph><p>Depending on the mechanism type, there can be an additional <code>config</code> property, which then holds the mechanism’s specific configuration and an <code>if</code> property, which specifies when a particular mechanism should be executed.</p></div><div class=paragraph><p>Every mechanism type can be configured as many times as needed. However, for those, which don’t have a configuration, it doesn’t really make sense, as all of them would behave the same way.</p></div><div class=paragraph><p>For example, your authenticator definitions could look like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>mechanisms</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>authenticators</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>baz</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bla</span>
    <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#a6e22e>bla</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>zab</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>oof</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bla</span>
    <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#a6e22e>bar</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bla</span></code></pre></div></div><div class=paragraph><p>The above snippet configures two instances of an imaginary authenticator of a type <code>bar</code>, made available for usage in rules via ids <code>foo</code> and <code>zab</code>, as well as two instances of an imaginary authenticator of a type <code>bla</code>, made available for usage in rule via ids <code>baz</code> and <code>oof</code>. The <code>baz</code> and <code>oof</code> authenticators are different, as they are configured differently, but <code>foo</code> and <code>zab</code> authenticators do not have any configuration. So, they behave the same way and there is actually no need to define two instances of them.</p></div><div class=paragraph><p>In simplest case a rule will just reuse mechanisms in its pipeline. In more complex cases a rule can reconfigure parts of it (More about rules configuration can be found <a href=../../../../../docs/configuration/rules/configuration/>here</a>). Which parts can be reconfigured, respectively overridden are mechanism specific and described in the mechanism specific documentation. Reconfiguration is always limited to the particular rule pipeline and does not affect other rules.</p></div><div class=paragraph><p>Here is an example which configures a couple of mechanisms:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>mechanisms</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>authenticators</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>anon_authn</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>anonymous</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>opaque_auth_token_authn</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>oauth2_introspection</span>
    <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#a6e22e>introspection_endpoint</span><span style=color:#fff;background-color:#272822>:</span>
        <span style=color:#a6e22e>url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>http://hydra:4445/oauth2/introspect</span>
    <span style=color:#a6e22e>assertions</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#a6e22e>issuers</span><span style=color:#fff;background-color:#272822>:</span>
        <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>http://127.0.0.1:4444/</span>
  <span style=color:#a6e22e>authorizers</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>deny_all_authz</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>deny</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>local_authz</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>cel</span>
    <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#a6e22e>expressions</span><span style=color:#fff;background-color:#272822>:</span>
        <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>expression</span><span style=color:#fff;background-color:#272822>:</span>
            <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>manager&#34;</span> <span style=color:#e6db74>in Subject.Attributes.groups</span>
          <span style=color:#a6e22e>message</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>user is not in the expected group</span>
  <span style=color:#a6e22e>contextualizers</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>group_manager</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>generic</span>
    <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#a6e22e>endpoint</span><span style=color:#fff;background-color:#272822>:</span>
        <span style=color:#a6e22e>url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>http://group-manager.local/groups</span>
        <span style=color:#a6e22e>method</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>GET</span>
      <span style=color:#a6e22e>forward_headers</span><span style=color:#fff;background-color:#272822>:</span>
        <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>Authorization</span>
      <span style=color:#a6e22e>cache_ttl</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>1m</span>
  <span style=color:#a6e22e>finalizers</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>jwt_finalizer</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>jwt</span>
    <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#a6e22e>ttl</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>5m</span>
      <span style=color:#a6e22e>claims</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>|</span>
          <span style=color:#e6db74>{</span>
            <span style=color:#e6db74>{{ $user_name := .Subject.Attributes.identity.user_name -}}</span>
            <span style=color:#e6db74>&#34;email&#34;: {{ quote .Subject.Attributes.identity.email }},</span>
            <span style=color:#e6db74>&#34;email_verified&#34;: {{ .Subject.Attributes.identity.email_verified }},</span>
            <span style=color:#e6db74>{{ if $user_name -}}</span>
            <span style=color:#e6db74>&#34;name&#34;: {{ quote $user_name }}</span>
            <span style=color:#e6db74>{{ else -}}</span>
            <span style=color:#e6db74>&#34;name&#34;: {{ quote $email }}</span>
            <span style=color:#e6db74>{{ end -}}</span>
          <span style=color:#e6db74>}</span>
  <span style=color:#a6e22e>error_handlers</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>default</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>default</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>authenticate_with_kratos</span>
    <span style=color:#a6e22e>if</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>|</span>
      <span style=color:#e6db74>type(Error) in [authentication_error, authorization_error] &amp;&amp;</span>
      <span style=color:#e6db74>Request.Header(&#34;Accept&#34;).contains(&#34;text/html&#34;)</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>redirect</span>
    <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#a6e22e>to</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>http://127.0.0.1:4433/self-service/login/browser?return_to={{ .Request.URL | urlenc }}</span></code></pre></div></div></div></div><div class=sect1><h2 id=_evaluation_objects>Evaluation Objects</h2><div class=sectionbody><div class=paragraph><p>Some mechanisms support, respectively require access to different types of objects they work on, e.g. to render a header with specific values, or to check whether some expectations apply. Following objects are available and have the following structure:</p></div><div class=sect2><h3 id=_subject>Subject</h3><div class=paragraph><p>This object contains the information about the authenticated subject and has the following attributes:</p></div><div class=ulist><ul><li><p><strong><code>ID</code></strong>: <em>string</em></p><div class=paragraph><p>The identifier of the subject. This value is set by the authenticator, which was able to authenticate the subject.</p></div></li><li><p><strong><code>Attributes</code></strong>: <em>map</em></p><div class=paragraph><p>Contains all attributes, which are known about the subject. The content is initially set by the authenticator, which was able to authenticate the subject. Mechanisms following the authenticator in a rule pipeline can update it, but cannot override any entries.</p></div></li></ul></div><div class=paragraph><p>Each object of this type can be thought as a JSON object. Here some examples:</p></div><div class=exampleblock><div class=title>Example 1. Subject created by an Anonymous Authenticator</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=javascript><span style=color:#fff;background-color:#272822>Subject</span> <span style=color:#f92672>=</span> <span style=color:#fff;background-color:#272822>{</span>
  <span style=color:#a6e22e>ID</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>anonymous</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
  <span style=color:#a6e22e>Attributes</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>{}</span>
<span style=color:#fff;background-color:#272822>}</span></code></pre></div></div></div></div><div class=exampleblock><div class=title>Example 2. Possible Subject created by an OAuth2 Authenticator</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=javascript><span style=color:#fff;background-color:#272822>Subject</span> <span style=color:#f92672>=</span> <span style=color:#fff;background-color:#272822>{</span>
  <span style=color:#a6e22e>ID</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>foobar</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
  <span style=color:#a6e22e>Attributes</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>{</span>
    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>sub</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>foobar</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>exp</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>1670600805</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>jti</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>7b91ed8a-0251-4e02-8d51-9792785851e8</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>iat</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>1670600305</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>iss</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>http://testauthserver.local</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>nbf</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>1670600305</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>extra</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>{</span>
        <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>foo</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>bar</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>baz</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>]</span>
    <span style=color:#fff;background-color:#272822>}</span>
  <span style=color:#fff;background-color:#272822>}</span>
<span style=color:#fff;background-color:#272822>}</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_request>Request</h3><div class=paragraph><p>This object contains information about the request handled by heimdall and has the following attributes and methods:</p></div><div class=ulist><ul><li><p><strong><code>Method</code></strong>: <em>string</em></p><div class=paragraph><p>The HTTP method used, like <code>GET</code>, <code>POST</code>, etc.</p></div></li><li><p><strong><code>URL</code></strong>: <em>URL</em></p><div class=paragraph><p>The URL of the matched request. This object has the following properties and methods:</p></div><div class=ulist><ul><li><p><strong><code>Scheme</code></strong>: <em>string</em></p><div class=paragraph><p>The HTTP scheme part of the url</p></div></li><li><p><strong><code>Host</code></strong>: <em>string</em></p><div class=paragraph><p>The host part of the url</p></div></li><li><p><strong><code>Path</code></strong>: <em>string</em></p><div class=paragraph><p>The path part of the url</p></div></li><li><p><strong><code>RawQuery</code></strong>: <em>string</em></p><div class=paragraph><p>The raw query part of the url.</p></div></li><li><p><strong><code>String()</code></strong>: <em>method</em></p><div class=paragraph><p>This method returns the URL as valid URL string of a form <code>scheme:host/path?query</code>.</p></div></li><li><p><strong><code>Query()</code></strong>: <em>method</em></p><div class=paragraph><p>The parsed query with each key-value pair being a string to array of strings mapping.</p></div></li></ul></div></li><li><p><strong><code>ClientIPAddresses</code></strong>: <em>string array</em></p><div class=paragraph><p>The list of IP addresses the request passed through with the first entry being the ultimate client of the request. Only available if heimdall is configured to trust the client, sending this information, e.g. in the <code>X-Forwarded-From</code> header (see e.g. Decision Service <a href=../../../../../docs/configuration/services/decision/#_trusted_proxies>trusted_proxies</a> configuration for more details).</p></div></li><li><p><strong><code>Header(name)</code></strong>: <em>method</em>,</p><div class=paragraph><p>This method expects the name of a header as input and returns its value as a <code>string</code>. If the header is not present in the HTTP request an empty string (<code>""</code>) is returned. If a header appears multiple times in the request, the returned <code>string</code> is a comma separated list of all values.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>A single header may be a comma separated list of actual values as well. Best example is the <code>Accept</code> header, which might be set to e.g. <code>text/html,application/xhtml+xml,application/xml;q=0.9,<strong>/</strong>;q=0.8</code>).</td></tr></tbody></table></div></li><li><p><strong><code>Cookie(name)</code></strong>: <em>method</em>,</p><div class=paragraph><p>This method expects the name of a cookie as input and returns the value of it as <code>string</code>. If the cookie is not present in the HTTP request an empty string (<code>""</code>) is returned.</p></div></li><li><p><strong><code>Body()</code></strong>: <em>method</em>,</p><div class=paragraph><p>The parsed body with contents depending on the <code>Content-Type</code> header. Supported content types are any MIME types with <code>json</code> or <code>yaml</code> subtype, as well as <code>application/x-www-form-urlencoded</code>. If MIME type is unsupported, the method returns a string with the actual body contents.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>The actual request body is parsed only on the first use of this function. All subsequent calls return the cached result.</td></tr></tbody></table></div><div class=exampleblock><div class=title>Example 3. Example results</div><div class=content><div class=paragraph><p>If the <code>Content-Type</code> header is set to <code>application/json</code> and the actual request body is a valid JSON object, shown below</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=json><span style=color:#fff;background-color:#272822>{</span><span style=color:#fff;background-color:#272822> </span><span style=color:#fff;background-color:#272822>&#34;context&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;heimdall&#34;</span><span style=color:#fff;background-color:#272822> </span><span style=color:#fff;background-color:#272822>}</span></code></pre></div></div><div class=paragraph><p>The call to the <code>Body()</code> function will return exactly this representation as a map.<br></p></div><div class=paragraph><p>If the <code>Content-Type</code> header is set to <code>application/yaml</code> and the actual request body is a valid YAML object, shown below</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>context</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>heimdall</span></code></pre></div></div><div class=paragraph><p>The call to the <code>Body()</code> function will return <code>{ "context": "heimdall" }</code> representation as a map.<br></p></div><div class=paragraph><p>If the <code>Content-Type</code> header is set to <code>application/x-www-form-urlencoded</code> and the actual request body is a valid object, shown below</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#e6db74>context=heimdall</span></code></pre></div></div><div class=paragraph><p>The call to the <code>Body()</code> function will return this representation as a map with each value being a string array. In this particular case as <code>{ "context": [ "heimdall" ] }</code>.</p></div></div></div></li></ul></div><div class=paragraph><p>Here is an example for a request object:</p></div><div class=exampleblock><div class=title>Example 4. Example request object</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=javascript><span style=color:#fff;background-color:#272822>Request</span> <span style=color:#f92672>=</span> <span style=color:#fff;background-color:#272822>{</span>
  <span style=color:#a6e22e>Method</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>GET</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
  <span style=color:#a6e22e>Url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>{</span>
    <span style=color:#a6e22e>Scheme</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>https</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
    <span style=color:#a6e22e>Host</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>localhost</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
    <span style=color:#a6e22e>Path</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>/test</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
    <span style=color:#a6e22e>RawQuery</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>baz=zab&amp;baz=bar&amp;foo=bar</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#fff;background-color:#272822>},</span>
  <span style=color:#a6e22e>ClientIP</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>127.0.0.1</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>10.10.10.10</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>]</span>
<span style=color:#fff;background-color:#272822>}</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_payload>Payload</h3><div class=paragraph><p>This object represents the contents of a payload, like the request body or a response body. The contents depend on the MIME-Type of the payload. For <code>json</code>, <code>yaml</code> or <code>x-www-form-urlencoded</code> encoded payload, the object is transformed to a JSON object. Otherwise, it is just a string.</p></div><div class=paragraph><p>Here some examples:</p></div><div class=exampleblock><div class=title>Example 5. Structured payload</div><div class=content><div class=paragraph><p>The following JSON object is a typical response from OPA.</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=javascript><span style=color:#fff;background-color:#272822>Payload</span> <span style=color:#f92672>=</span> <span style=color:#fff;background-color:#272822>{</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>result</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#66d9ef>true</span> <span style=color:#fff;background-color:#272822>}</span></code></pre></div></div></div></div><div class=exampleblock><div class=title>Example 6. Unstructured payload</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=javascript><span style=color:#fff;background-color:#272822>Payload</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>SomeStringValue</span><span style=color:#e6db74>&#34;</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_error>Error</h3><div class=paragraph><p>This object represents an error, which has been raised during the execution of the pipeline and is available in <code>if</code> <a href=#_expressions>CEL expressions</a> of <a href=../../../../../docs/configuration/rules/pipeline_mechanisms/error_handlers/>Error Handlers</a>. Following properties are available:</p></div><div class=ulist><ul><li><p><strong><code>Source</code></strong>: <em>string</em></p><div class=paragraph><p>The ID of the mechanism, which raised the error.</p></div></li></ul></div><div class=paragraph><p>Proper error handling requires attention to the actual <em><a href=../../../../../docs/configuration/reference/types/#_errorstate_type>error type</a></em> available via <code>type(Error)</code>.</p></div></div><div class=sect2><h3 id=_values>Values</h3><div class=paragraph><p>This object represents a key value map, with both, the key and the value being of string type. Though, the actual values can be templated (see (<a href=#_templating>Templating</a>). The contents and the variables available in templates depend on the configuration of the particular mechanism, respectively the corresponding override in a rule.</p></div><div class=paragraph><p>Here is an example:</p></div><div class=exampleblock><div class=title>Example 7. Example values object</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=javascript><span style=color:#fff;background-color:#272822>Values</span> <span style=color:#f92672>=</span> <span style=color:#fff;background-color:#272822>{</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>some-key-1</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>value-1</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>,</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>some-key-2</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>value-2</span><span style=color:#e6db74>&#34;</span>
<span style=color:#fff;background-color:#272822>}</span></code></pre></div></div></div></div></div></div></div><div class=sect1><h2 id=_templating>Templating</h2><div class=sectionbody><div class=paragraph><p>Some pipeline mechanisms support templating using <a href=https://golang.org/pkg/text/template/>Golang Text Templates</a>. Templates can act on all objects described above (<a href=#_subject>Subject</a>, <a href=#_request>Request</a>, <a href=#_payload>Payload</a> and <a href=#_values>Values</a>). Which exactly are supported is mechanism specific.</p></div><div class=paragraph><p>To ease the usage, all <a href=http://masterminds.github.io/sprig/>sprig</a> functions, except <code>env</code> and <code>expandenv</code>, as well as the following functions are available:</p></div><div class=ulist><ul><li><p><code>urlenc</code> - Encodes a given string using url encoding. Is handy if you need to generate request body or query parameters e.g. for communication with further systems.</p></li><li><p><code>atIndex</code> - Implements python-like access to arrays and takes as a single argument the index to access the element in the array at. With index being a positive values it works exactly the same way, as with the usage of the build-in index function to access array elements. With negative index value, one can access the array elements from the tail of the array. -1 is the index of the last element, -2 the index of the element before the last one, etc.</p><div class=paragraph><p>Example: <code>{{ atIndex 2 [1,2,3,4,5] }}</code> evaluates to <code>3</code> (behaves the same way as the <code>index</code> function) and <code>{{ atIndex -2 [1,2,3,4,5] }}</code> evaluates to <code>4</code>.</p></div></li><li><p><code>splitList</code> - Splits a given string using a separator (part of the sprig library, but not documented). The result is a string array.</p><div class=paragraph><p>Example: <code>{{ splitList "/" "/foo/bar" }}</code> evaluates to the <code>["", "foo", "bar"]</code> array.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 8. Rendering a JSON object</div><div class=content><div class=paragraph><p>Imagine, we have a <code>POST</code> request for the URL <code>http://foobar.baz/zab?foo=bar</code>, with a header <code>X-Foo</code> set to <code>bar</code> value, for which heimdall was able to identify a subject, with <code>ID=foo</code> and which <code>Attributes</code> contain an entry <code>email: foo@bar</code>, then you can generate a JSON object with this information with the following template:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=gotemplate>{
  &#34;subject_id&#34;: {{ quote .Subject.ID }},
  &#34;email&#34;: {{ quote .Subject.Attributes.email }},
  &#34;request_url&#34;: {{ quote .Request.URL }},
  &#34;foo_value&#34;: {{ index .Request.URL.Query.foo 0 | quote }}
  &#34;request_method&#34;: {{ quote .Request.Method }},
  &#34;x_foo_value&#34;: {{ .Request.Header &#34;X-Foo&#34; | quote }}
}</code></pre></div></div><div class=paragraph><p>Please note how the access to the <code>foo</code> query parameter is done. Since <code>.Request.URL.Query.foo</code> returns an array of strings, the first element is taken to render the value for the <code>foo_value</code> key.</p></div><div class=paragraph><p>This will result in the following JSON object:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=json><span style=color:#fff;background-color:#272822>{</span><span style=color:#fff;background-color:#272822>
    </span><span style=color:#fff;background-color:#272822>&#34;subject_id&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;foo&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
    </span><span style=color:#fff;background-color:#272822>&#34;email&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;foo@bar.baz&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
    </span><span style=color:#fff;background-color:#272822>&#34;request_url&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;http://foobar.baz/zab?foo=bar&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
    </span><span style=color:#fff;background-color:#272822>&#34;foo_value&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;bar&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
    </span><span style=color:#fff;background-color:#272822>&#34;request_method&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;POST&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
    </span><span style=color:#fff;background-color:#272822>&#34;x_foo_value&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;bar&#34;</span><span style=color:#fff;background-color:#272822>
</span><span style=color:#fff;background-color:#272822>}</span></code></pre></div></div></div></div><div class=exampleblock><div class=title>Example 9. Access the last part of the path</div><div class=content><div class=paragraph><p>Imagine, we have a <code>POST</code> request to the URL <code>http://foobar.baz/zab/1234</code>, with <code>1234</code> being the identifier of a file, which should be updated with the contents sent in the body of the request, and you would like to control access to the aforesaid object using e.g. OpenFGA. This can be achieved with the following authorizer:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>openfga_authorizer</span>
<span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>remote</span>
<span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>endpoint</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>https://openfga/stores/files/check</span>
  <span style=color:#a6e22e>payload</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>|</span>
    <span style=color:#e6db74>{</span>
      <span style=color:#e6db74>&#34;user&#34;: &#34;user:{{ .Subject.ID }}&#34;,</span>
      <span style=color:#e6db74>&#34;relation&#34;: &#34;write&#34;,</span>
      <span style=color:#e6db74>&#34;object&#34;: &#34;file:{{ splitList &#34;/&#34; .Request.URL.Path | last }}&#34;</span>
    <span style=color:#e6db74>}</span>
  <span style=color:#a6e22e>expressions</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>expression</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>|</span>
      <span style=color:#e6db74>Payload.allowed == true</span></code></pre></div></div><div class=paragraph><p>Please note how the <code>"object"</code> is set in the <code>payload</code> property above. When the <code>payload</code> template is rendered and for the above said request heimdall was able to identify the subject with <code>ID=foo</code>, following JSON object will be created:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=json><span style=color:#fff;background-color:#272822>{</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;user&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;user:foo&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;relation&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;write&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;object&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;file:1234&#34;</span><span style=color:#fff;background-color:#272822>
</span><span style=color:#fff;background-color:#272822>}</span></code></pre></div></div></div></div><div class=paragraph><p>You can find further examples as part of mechanism descriptions, supporting templating.</p></div></div></div><div class=sect1><h2 id=_expressions>Expressions</h2><div class=sectionbody><div class=paragraph><p>Expressions can be used to execute authorization logic. As of today only <a href=https://github.com/google/cel-spec>CEL</a> is supported as expression language. All standard, as well as <a href=https://pkg.go.dev/github.com/google/cel-go/ext#pkg-functions>extension</a> functions are available. Which of the <a href=#_evaluation_objects>evaluation objects</a> are available to the expression depends on the mechanism.</p></div><div class=paragraph><p>In addition to the build-in, respectively extension methods and functions, as well as the methods available on the evaluation objects, following functions are available as well:</p></div><div class=ulist><ul><li><p><code>split</code> - this function works on strings and expects a separator as a single argument. The result is a string array.</p><div class=paragraph><p>Example: <code>"/foo/bar/baz".split("/")</code> returns <code>["", "foo", "bar", "baz"]</code>.</p></div></li><li><p><code>regexFind</code> - this function returns the first (left most) match of a regular expression in the given string.</p><div class=paragraph><p>Example: <code>"abcd1234".regexFind("[a-zA-Z][1-9]")</code> returns <code>"d1"</code>.</p></div></li><li><p><code>regexFindAll</code> - this function returns an array of all matches of a regular expression in the given string.</p><div class=paragraph><p>Example: <code>"123456789".regexFindAll("[2,4,6,8]")</code> returns <code>["2","4","6","8"]</code>.</p></div></li><li><p><code>at</code> - this function implements python-like access to arrays and takes as a single argument the index to access the element in the array at. With index being a positive values it works exactly the same way, as with the usage of <code>[]</code> to access array elements. With negative index value, one can access the array elements from the tail of the array. -1 is the index of the last element, -2 the index of the element before the last one, etc.</p><div class=paragraph><p>Example: <code>[1,2,3,4,5].at(2)</code> returns <code>3</code> and <code>[1,2,3,4,5].at(-2)</code> returns <code>4</code>.</p></div></li><li><p><code>last</code> - this function works on arrays and returns the last element of an array or <code>nil</code> if the array is empty.</p><div class=paragraph><p>Example: <code>[1,2,3,4,5].last()</code> returns <code>5</code></p></div></li></ul></div><div class=paragraph><p>Some examples:</p></div><div class=exampleblock><div class=title>Example 10. Evaluate Payload object</div><div class=content><div class=paragraph><p>Given the following Payload object</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=javascript><span style=color:#fff;background-color:#272822>Payload</span> <span style=color:#f92672>=</span> <span style=color:#fff;background-color:#272822>{</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>result</span><span style=color:#e6db74>&#34;</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#66d9ef>true</span> <span style=color:#fff;background-color:#272822>}</span></code></pre></div></div><div class=paragraph><p>a CEL expression to check the <code>result</code> attribute is set to <code>true</code>, would look as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=cel>Payload.result == true</code></pre></div></div></div></div><div class=exampleblock><div class=title>Example 11. Check whether the user is member of the admin group</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=cel>has(Subject.Attributes.groups) &amp;&amp;
   Subject.Attributes.groups.exists(g, g == &#34;admin&#34;)</code></pre></div></div></div></div><div class=exampleblock><div class=title>Example 12. Access the last path part of the matched URL</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=cel>Request.URL.Path.split(&#34;/&#34;).last()</code></pre></div></div></div></div><div class=exampleblock><div class=title>Example 13. Check if an error has been raised by an authenticator with the ID "foo"</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=cel>type(Error) == authentication_error &amp;&amp; Error.Source == &#34;foo&#34;</code></pre></div></div></div></div></div></div></linkable-headline-area></div><p class="text-end fst-italic fs-7">Last updated on <span class=fw-bold>Nov 28, 2023</span></p><div class="d-flex justify-content-between"><a href=../../../../../docs/configuration/rules/overview/><div class="fs-6 mb-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-chevron-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5.0 010 .708L5.707 8l5.647 5.646a.5.5.0 01-.708.708l-6-6a.5.5.0 010-.708l6-6a.5.5.0 01.708.0z"/></svg>Rules Overview</div></a><a class=ms-auto href=../../../../../docs/configuration/rules/pipeline_mechanisms/authenticators/><div class="fs-6 mb-3">Authenticators<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"/></svg></div></a></div></main></div><footer class="footer py-4 py-md-5 px-4 px-md-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022-2023 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../../>Home</a></li><li class=mb-2><a href=../../../../../docs/welcome>Docs</a></li><li class=mb-2><a href=../../../../../openapi/>API</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../../docs/operations/install/>Install</a></li><li class=mb-2><a href=../../../../../docs/getting_started/>Getting Started</a></li><li class=mb-2><a href=../../../../../docs/guides/>Integration Guides</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://discord.gg/qQgg8xKuyb>Discord</a></li></ul></div></div></div></footer><script src=../../../../../js/main.js defer></script>
<script src=https://cdn.redoc.ly/redoc/latest/bundles/redoc.standalone.js></script></body></html>