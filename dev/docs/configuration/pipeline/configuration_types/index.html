<!doctype html><html lang=en><head><title>Configuration Types</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Heimdall is an open source identity & access proxy (IAP) and access control decision API, designed for cloud native applications"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../../favicon.ico></head><body><header class="navbar navbar-expand-md navbar-dark bg-dark sticky-top"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand text-white" href=../../../../>Heimdall</a>
<button class=navbar-toggler type=button data-bs-toggle=offcanvas data-bs-target=#mainMenuContent aria-controls=mainMenuContent aria-expanded=false aria-label="Open main menu">
<span class=navbar-toggler-icon></span></button><div class="offcanvas offcanvas-end bg-dark" tabindex=-1 id=mainMenuContent data-bs-scroll=true aria-labelledby=mainMenuContentLabel><div class=offcanvas-header><h4 class="offcanvas-title text-white" id=mainMenuContentLabel>Heimdall</h4><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class=offcanvas-body><ul class="navbar-nav flex-column flex-md-row"><li class=nav-item><a class='nav-link text-white' href=../../../../docs/welcome>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../../openapi/>API</a></li><li class="nav-item dropdown"><a class='nav-link dropdown-toggle text-white' href=# id="Get Started-navbarDropdown" role=button data-bs-toggle=dropdown aria-expanded=false>Get Started</a><ul class="dropdown-menu bg-dark" aria-labelledby="Get Started-navbarDropdown"><li><a class='dropdown-item text-white' href=../../../../docs/getting_started/concepts/>Concepts</a></li><li><a class='dropdown-item text-white' href=../../../../docs/getting_started/decision_api_quickstart/>Decision API Quickstart</a></li><li><a class='dropdown-item text-white' href=../../../../docs/getting_started/proxy_quickstart/>Proxy Quickstart</a></li></ul></li></ul><hr class="text-white-50 d-md-none"><ul class="navbar-nav flex-column ms-auto"><doc-version-select class="nav-item dropdown" version-file=/heimdall/data.json current-version=dev current-page=/docs/configuration/pipeline/configuration_types/><button class="btn btn-dark dropdown-toggle me-4" data-bs-toggle=dropdown aria-expanded=false>
dev</button></doc-version-select></ul><ul class="navbar-nav flex-column"><li class="nav-item mb-1"><a class="nav-link text-white" href=https://github.com/dadrus/heimdall><svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div></nav></header><nav class="navbar navbar-expand-lg bg-light" aria-label="Docs menu"><div class=container-xxl><doc-search index-file=/heimdall/dev/index.json path-prefix=/heimdall/dev><form id=docs-search tabindex=1 class="doks-search position-relative me-auto"><input id=search class="form-control search-bar" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=search-suggestions class="shadow bg-white rounded collapse search-results"></div></form></doc-search><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#docsMenuContent aria-controls=docsMenuContent aria-expanded=false aria-label="Open docs menu"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-arrow-down-up" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.5 15a.5.5.0 00.5-.5V2.707l3.146 3.147a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 10.708.708L11 2.707V14.5a.5.5.0 00.5.5zm-7-14a.5.5.0 01.5.5v11.793l3.146-3.147a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 01.708-.708L4 13.293V1.5a.5.5.0 01.5-.5z"/></svg></button><div class=d-md-none><div class="collapse navbar-collapse" id=docsMenuContent><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/welcome/>Welcome</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 aria-expanded=true>
Getting Started</button><div id=section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/concepts/>Concepts</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/decision_api_quickstart/>Decision API Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/proxy_quickstart/>Proxy Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/configuration_introduction/>Configuration Introduction</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a aria-expanded=true>
Operations</button><div id=section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/operations/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/cli/>CLI</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/observability/>Observability</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/security/>Security</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-929a28d261428029e61c0f81c6161fd71ba0b2fe aria-expanded=true>
Guides</button><div id=section-929a28d261428029e61c0f81c6161fd71ba0b2fe class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li><li class=nav-item><a class=nav-link href=../../../../docs/guides/nginx/>NGINX Integration</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 aria-expanded=true>
Configuration</button><div id=section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 class="collapse show"><ul class="nav flex-column"><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-5cbd584046863bc7b753e57e8681a98a87f36f0f aria-expanded=true>
Services</button><div id=section-5cbd584046863bc7b753e57e8681a98a87f36f0f class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/decision_api/>Decision API</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/proxy/>Proxy</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/management/>Management</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/configuration_types/>Common Configuration Options</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-e2397377af6d698b0fb66f53c47349a85bd2cb00 aria-expanded=true>
Observability</button><div id=section-e2397377af6d698b0fb66f53c47349a85bd2cb00 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/tracing/>Tracing</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a aria-expanded=true>
Pipeline Handler</button><div id=section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/overview/>Pipeline Overview</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/hydrators/>Hydrators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/mutators/>Mutators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/error_handlers/>Error Handlers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/configuration_types/>Configuration Types</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a aria-expanded=true>
Rules</button><div id=section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/overview/>Rules Overview</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/default_rule/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/rule_configuration/>Rule Definition</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/providers/>Rule Providers</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/signature_keys_and_certificates/>Signature Keys & Certificates</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-db1c784524e1b54011a95823026161f7c8517fe0 aria-expanded=true>
Reference</button><div id=section-db1c784524e1b54011a95823026161f7c8517fe0 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/reference/configuration/>Static Configuration</a></li></ul></div></li></ul></div></li></ul></div></div></div></nav><div class="container-xxl d-xxl-flex"><aside class="d-none d-md-block pe-4 pt-4 flex-xxl-shrink-0"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/welcome/>Welcome</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 aria-expanded=true>
Getting Started</button><div id=section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/concepts/>Concepts</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/decision_api_quickstart/>Decision API Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/proxy_quickstart/>Proxy Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/configuration_introduction/>Configuration Introduction</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a aria-expanded=true>
Operations</button><div id=section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/operations/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/cli/>CLI</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/observability/>Observability</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/security/>Security</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-929a28d261428029e61c0f81c6161fd71ba0b2fe aria-expanded=true>
Guides</button><div id=section-929a28d261428029e61c0f81c6161fd71ba0b2fe class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li><li class=nav-item><a class=nav-link href=../../../../docs/guides/nginx/>NGINX Integration</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 aria-expanded=true>
Configuration</button><div id=section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 class="collapse show"><ul class="nav flex-column"><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-5cbd584046863bc7b753e57e8681a98a87f36f0f aria-expanded=true>
Services</button><div id=section-5cbd584046863bc7b753e57e8681a98a87f36f0f class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/decision_api/>Decision API</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/proxy/>Proxy</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/management/>Management</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/configuration_types/>Common Configuration Options</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-e2397377af6d698b0fb66f53c47349a85bd2cb00 aria-expanded=true>
Observability</button><div id=section-e2397377af6d698b0fb66f53c47349a85bd2cb00 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/tracing/>Tracing</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a aria-expanded=true>
Pipeline Handler</button><div id=section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/overview/>Pipeline Overview</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/hydrators/>Hydrators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/mutators/>Mutators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/error_handlers/>Error Handlers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/configuration_types/>Configuration Types</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a aria-expanded=true>
Rules</button><div id=section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/overview/>Rules Overview</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/default_rule/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/rule_configuration/>Rule Definition</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/providers/>Rule Providers</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/signature_keys_and_certificates/>Signature Keys & Certificates</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-db1c784524e1b54011a95823026161f7c8517fe0 aria-expanded=true>
Reference</button><div id=section-db1c784524e1b54011a95823026161f7c8517fe0 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/reference/configuration/>Static Configuration</a></li></ul></div></li></ul></div></li></ul></aside><main class="px-3 pt-4 flex-xxl-grow-0"><h1>Configuration Types</h1><div><div class=sect1><h2 id=_assertions>Assertions</h2><div class=sectionbody><div class=paragraph><p>This type enables configuration of required token and claim assertions. Depending on the object type (JWT or introspection response), the assertions apply to different parts of such objects.</p></div><div class=ulist><ul><li><p><strong><code>scopes</code></strong>: <em><a href=#_scopes_matcher>Scopes Matcher</a></em> (optional)</p><div class=paragraph><p>Required scopes given to the client.</p></div></li><li><p><strong><code>audience</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>Required entries in the <code>aud</code> claim. Both cases, either as whitespace separated string, or a JSON array are considered.</p></div></li><li><p><strong><code>issuers</code></strong>: <em>string array</em> (mandatory)</p><div class=paragraph><p>Issuers to trust. At least one issuer must be configured.</p></div></li><li><p><strong><code>allowed_algorithms</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>Algorithms, which are trusted (according to <a href=https://datatracker.ietf.org/doc/html/rfc7518>RFC 7518</a>). Defaults to the following list: ES256, ES384, ES512, PS256, PS384, PS512.</p></div></li><li><p><strong><code>validity_leeway</code></strong> <em><a href=#_duration>Duration</a></em> (optional)</p><div class=paragraph><p>The time leeway to consider while verifying the <code>iat</code>, <code>exp</code> and the <code>nbf</code>. Defaults to 10 seconds.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 1. Assertions configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>issuers</span><span style=color:#fff;background-color:#272822>:</span>
 <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>foo</span>
 <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>bar</span>
<span style=color:#a6e22e>audience</span><span style=color:#fff;background-color:#272822>:</span>
 <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>zap</span>
<span style=color:#a6e22e>scopes</span><span style=color:#fff;background-color:#272822>:</span>
 <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>baz</span>
<span style=color:#a6e22e>allowed_algorithms</span><span style=color:#fff;background-color:#272822>:</span>
 <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>ES512</span>
<span style=color:#a6e22e>validity_leeway</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>5s</span></code></pre></div></div><div class=paragraph><p>Here we say, the token must have been issued either by the issuer <code>foo</code>, or the issuer <code>bar</code>, the <code>aud</code> claim must contain <code>zap</code>, the scope claim (either <code>scp</code> or <code>scope</code>) must be present and contain the scope <code>baz</code>, if the token or the introspection response is signed, it must have been signed by using the <code>ES512</code> algorithm (ECDSA using P-521 and SHA-512) and if the information about token validity is present, we respect a deviation of 5 seconds.</p></div></div></div></div></div><div class=sect1><h2 id=_authentication_data_source>Authentication Data Source</h2><div class=sectionbody><div class=paragraph><p>An authentication data source is actually a list of possible strategies for subject authentication data retrieval. The entries following the first one are fallbacks and are only executed if the previous strategy could not retrieve the required authentication data from the request.</p></div><div class=paragraph><p>This fallback mechanism can become handy, if different clients of your application send the authentication data using different methods. <a href=https://datatracker.ietf.org/doc/html/rfc6750>RFC 6750</a> describes for example how to use bearer tokens in HTTP requests to access OAuth 2.0 protected resources. This RFC says, a token can either be sent in the <code>Authorization</code> header, or in a query parameter, or even as part of the HTTP body. So you can define the following list to let Heimdall try to extract the access token from all three places:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>header</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>Authorization</span>
  <span style=color:#a6e22e>schema</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>Bearer</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>query_parameter</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>access_token</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>body_parameter</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>access_token</span></code></pre></div></div><div class=paragraph><p>The available strategies are described in the following sections.</p></div><div class=sect2><h3 id=_cookie_strategy>Cookie Strategy</h3><div class=paragraph><p>This strategy can retrieve authentication data from a specific HTTP cookie. Following properties are supported:</p></div><div class=ulist><ul><li><p><strong><code>cookie</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the cookie to use.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 2. Cookie Strategy usage</div><div class=content><div class=paragraph><p>Imagine you want Heimdall to verify an authentication session, which is represented by a specific cookie before the request hits your upstream service. If the client of your upstream application, which is case of a cookie would usually be a browser sends a cookie named "session", you can inform Heimdall to extract and use it by configuring this strategy as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>cookie</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>my_session_cookie</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_header_strategy>Header Strategy</h3><div class=paragraph><p>This strategy can retrieve authentication data from a specific HTTP header. Following properties are supported:</p></div><div class=ulist><ul><li><p><strong><code>header</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the header to use.</p></div></li><li><p><strong><code>schema</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>Schema, which should be present in the header value. If specified, but not present in the header value, the authentication data cannot be retrieved, effectively making the affected authenticator feel not responsible for the request.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 3. Header Strategy usage</div><div class=content><div class=paragraph><p>Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the HTTP <code>Authorization</code> header, you can inform Heimdall to extract it from there by configuring this strategy as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>header</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>Authorization</span>
  <span style=color:#a6e22e>schema</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>Bearer</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_query_parameter_strategy>Query Parameter Strategy</h3><div class=ulist><ul><li><p><strong><code>query_parameter</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the query parameter to use.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 4. Query Parameter Strategy usage</div><div class=content><div class=paragraph><p>Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the query parameter named "access_token", you can inform Heimdall to extract it from there by configuring this strategy as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>query_parameter</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>access_token</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_body_parameter_strategy>Body Parameter Strategy</h3><div class=paragraph><p>The usage of this strategy is only possible when the request payload is either JSON or <code>application/x-www-form-urlencoded</code> encoded. The <code>Content-Type</code> of the request must also either be set to <code>application/x-www-form-urlencoded</code> or to a MIME type, which contains <code>json</code>.</p></div><div class=ulist><ul><li><p><strong><code>body_parameter</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the body parameter to use.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 5. Body Parameter Strategy usage</div><div class=content><div class=paragraph><p>Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the body parameter named "access_token", you can inform Heimdall to extract it from there by configuring this strategy as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>body_parameter</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>access_token</span></code></pre></div></div></div></div></div></div></div><div class=sect1><h2 id=_authentication_strategy>Authentication Strategy</h2><div class=sectionbody><div class=paragraph><p>Authentication strategy is kind of abstract type, so you have to define which specific type to use. Each type has its own configuration options.</p></div><div class=paragraph><p>An AuthStrategy configuration entry must contain the following two properties:</p></div><div class=ulist><ul><li><p><code>type</code> - The type of the strategy. Available types are described in the following sections.</p></li><li><p><code>config</code> - The strategy specific configuration.</p></li></ul></div><div class=paragraph><p>Available strategies are described in the following sections.</p></div><div class=sect2><h3 id=_api_key_strategy>API Key Strategy</h3><div class=paragraph><p>This strategy can be used if your endpoint expects a specific api key be send in a header or a cookie.</p></div><div class=paragraph><p><code>type</code> must be set to <code>api_key</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>in</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>Where to put the api key. Can be either <code>header</code>, or <code>cookie</code>.</p></div></li><li><p><strong><code>name</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of either the header or the cookie.</p></div></li><li><p><strong><code>value</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The value of the api key.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 6. API Key Strategy configuration</div><div class=content><div class=paragraph><p>The following snippet shows how to configure this strategy to send an api key in the <code>X-My-API-Key</code> HTTP header.</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>api_key</span>
<span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>in</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>header</span>
  <span style=color:#a6e22e>name</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>X-My-API-Key</span>
  <span style=color:#a6e22e>value</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>super-duper-secret-key</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_basic_auth_strategy>Basic Auth Strategy</h3><div class=paragraph><p>This strategy can be used if your endpoint is protected by HTTP basic authentication and expects the HTTP <code>Authorization</code> header with required values.</p></div><div class=paragraph><p><code>type</code> must be set to <code>basic_auth</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>user</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The user-id.</p></div></li><li><p><strong><code>password</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The password.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 7. Basic Auth Strategy configuration</div><div class=content><div class=paragraph><p>The following snippet shows how to configure this strategy with user set to "Alladin" and password set to "open sesame"</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>basic_auth</span>
<span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>user</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>Alladin</span>
  <span style=color:#a6e22e>password</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>open sesame</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_client_credentials_strategy>Client Credentials Strategy</h3><div class=paragraph><p>This strategy implements the <a href=https://datatracker.ietf.org/doc/html/rfc6749#section-4.4>OAuth2 Client Credentials Grant Flow</a> to obtain an access token expected by the endpoint. Heimdall caches the received access token.</p></div><div class=paragraph><p><code>type</code> must be set to <code>client_credentials</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>client_id</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The client identifier for Heimdall.</p></div></li><li><p><strong><code>client_secret</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The client secret for Heimdall.</p></div></li><li><p><strong><code>scopes</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>The scopes required for the access token.</p></div></li><li><p><strong><code>token_url</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The token endpoint of the authorization server.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 8. Client Credentials Strategy configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>client_credentials</span>
<span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>token_url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>https://my-auth.provider/token</span>
  <span style=color:#a6e22e>client_id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
  <span style=color:#a6e22e>client_secret</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
  <span style=color:#a6e22e>scopes</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>baz</span>
    <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>zap</span></code></pre></div></div></div></div></div></div></div><div class=sect1><h2 id=_duration>Duration</h2><div class=sectionbody><div class=paragraph><p>Duration is actually a string type, which adheres to the following pattern: <code>^[0-9]+(ns|us|ms|s|m|h)$</code></p></div><div class=paragraph><p>So with <code>10s</code> you can define the duration of 10 seconds and with <code>2h</code> you can say 2 hours.</p></div></div></div><div class=sect1><h2 id=_endpoint>Endpoint</h2><div class=sectionbody><div class=paragraph><p>The Endpoint type defines properties required for the communication with an endpoint.</p></div><div class=ulist><ul><li><p><strong><code>url</code></strong> <em>string</em> (mandatory)</p><div class=paragraph><p>The actual url of the endpoint.</p></div></li><li><p><strong><code>method</code></strong> <em>string</em> (optional)</p><div class=paragraph><p>The HTTP method to use while communicating with the endpoint. If not set <code>POST</code> is used.</p></div></li><li><p><strong><code>retry</code></strong> <em><a href=#_retry>Retry</a></em> (optional)</p><div class=paragraph><p>What to do if the communication fails. If not configured, no retry attempts are done.</p></div></li><li><p><strong><code>auth</code></strong> <em><a href=#_authentication_strategy:>Authentication Strategy</a></em> (optional)</p><div class=paragraph><p>Authentication strategy to apply, if the endpoint requires authentication.</p></div></li><li><p><strong><code>headers</code></strong> <em>map of strings</em> (optional)</p><div class=paragraph><p>HTTP headers to be sent to the endpoint.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content>These headers are not analyzed by heimdall and are just forwarded to the endpoint. E.g. if you configure the <code>Content-Encoding</code> to something like <code>gzip</code>, the service behind the used endpoint might fail to answer, as it would expect the body to be compressed.</td></tr></tbody></table></div></li></ul></div><div class=exampleblock><div class=title>Example 9. Endpoint configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>endpoint</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>http://foo.bar</span>
  <span style=color:#a6e22e>method</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>GET</span>
  <span style=color:#a6e22e>retry</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>give_up_after</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>5s</span>
    <span style=color:#a6e22e>max_delay</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>1s</span>
  <span style=color:#a6e22e>auth</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>type</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>api_key</span>
    <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#a6e22e>name</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
      <span style=color:#a6e22e>value</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
      <span style=color:#a6e22e>in</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>cookie</span>
  <span style=color:#a6e22e>headers</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>X-My-First-Header</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foobar</span>
    <span style=color:#a6e22e>X-My-Second-Header</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>barfoo</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_error_condition>Error Condition</h2><div class=sectionbody><div class=paragraph><p>This type supports definition of conditions, under which an error handler should execute its logic. Such conditions are required for all error handlers, but the default one. All condition elements are evaluated using boolean <code>and</code>. Following conditions are possible:</p></div><div class=ulist><ul><li><p><strong><code>error</code></strong>: <em><a href=#_error_type>Error Type</a> array</em> (mandatory)</p><div class=paragraph><p>A list with error types to match. Configured entries are evaluated using a boolean <code>or</code> logic.</p></div></li><li><p><strong><code>request_cidr</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>A list with CIDR entries to match. Configured entries are evaluated using a boolean <code>or</code> logic.</p></div></li><li><p><strong><code>request_headers</code></strong>: <em>string array map</em> (optional)</p><div class=paragraph><p>A map with header names and the corresponding values to match. Configured entries are evaluated using a boolean <code>or</code> logic. This holds also true for the header values.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 10. Complex Error Condition configuration</div><div class=content><div class=paragraph><p>This example shows in principle all possible combinations. The actual values and the amount of them will for sure differ in your particular case. However, for showing the idea, the complexity of this example is enough.</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>error</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>precondition_error</span>
  <span style=color:#75715e># OR</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>authorization_error</span>
<span style=color:#75715e># AND</span>
<span style=color:#a6e22e>request_cidr</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>192.168.0.0/16</span>
  <span style=color:#75715e># OR</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>10.0.0.0/8</span>
<span style=color:#75715e># AND</span>
<span style=color:#a6e22e>request_headers</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>Accept</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>text/html</span>
    <span style=color:#75715e># OR</span>
    <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>*/*&#34;</span>
  <span style=color:#75715e># OR</span>
  <span style=color:#a6e22e>Content-Type</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>application/json</span></code></pre></div></div><div class=paragraph><p>This condition evaluates to true only if all parts of it (<code>error</code>, <code>request_cidr</code>, <code>request_headers</code>) evaluate to true. With
* <code>error</code> evaluates to true, if the encountered error was either <code>precondition_error</code> or <code>authorization_error</code>.
* <code>request_cidr</code> evaluates to true, if the request came from an IP in either <code>192.168.0.0/16</code> or <code>10.0.0.0/8</code> range. And
* <code>request_headers</code> evaluates to true, if either the HTTP <code>Accept</code> header contains one of <code>text/html</code>, or <code><strong>/</strong></code>, or the HTTP <code>Contet-Type</code> header contains <code>application/json</code>.</p></div></div></div><div class=exampleblock><div class=title>Example 11. Simple Error Condition configuration</div><div class=content><div class=paragraph><p>This example is a very simple one, showing just the usage of the <code>error</code> attribute:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>error</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>authentication_error</span></code></pre></div></div><div class=paragraph><p>This condition evaluate to true, if the encountered error was <code>authentication_error</code>.</p></div></div></div></div></div><div class=sect1><h2 id=_error_type>Error Type</h2><div class=sectionbody><div class=paragraph><p>Heimdall defines a couple of error types, which it uses to signal errors. Some of them are available for configuring your <a href=#_error_condition>Error Conditions</a>.</p></div><div class=paragraph><p>Following types are available:</p></div><div class=ulist><ul><li><p><code>authentication_error</code> - used if an authenticator failed to verify authentication data available in the request. E.g. an authenticator was configured to verify a JWT and the signature of it was invalid.</p></li><li><p><code>authorization_error</code> - used if an authorizer failed to authorize the subject. E.g. an authorizer is configured to use a script to execute on the given subject and request context, but this script returned with an error.</p></li><li><p><code>internal_error</code> - used if Heimdall run into an internal error condition while processing the request. E.g. something went wrong while unmarshalling a JSON object, or if there was a configuration error, which couldn’t be raised while loading a rule, etc.</p></li><li><p><code>precondition_error</code> - used if the request does not contain required/expected data. E.g. if an authenticator could not find a cookie configured.</p></li></ul></div></div></div><div class=sect1><h2 id=_retry>Retry</h2><div class=sectionbody><div class=paragraph><p>Implements an exponential backoff strategy for endpoint communication. It increases the backoff exponentially by multiplying the <code>max_delay</code> with 2^(attempt count)</p></div><div class=ulist><ul><li><p><strong><code>give_up_after</code></strong>: <a href=#_duration>Duration</a> (optional)</p><div class=paragraph><p>Sets an upper bound on the maximum time to wait between two requests. Default to 0, which means no upper bound.</p></div></li><li><p><strong><code>max_delay</code></strong>: _<a href=#_duration>Duration</a> (mandatory)</p><div class=paragraph><p>The initial backoff.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 12. Retry configuration</div><div class=content><div class=paragraph><p>In this example the backoff will be 1, 2, 4, 8, 16, 32, 60, …​</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>retry</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>give_up_after</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>60s</span>
    <span style=color:#a6e22e>max_delay</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>1s</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_scopes_matcher>Scopes Matcher</h2><div class=sectionbody><div class=paragraph><p>Scopes matcher is a configuration type allowing configuration of different strategies to match required scopes. In its simplest shape it can be just an array of strings (implemented by the <a href=#_exact>Exact</a>) scope matcher. To cover many use cases, different strategies are available and described in the following sections.</p></div><div class=paragraph><p>Regardless of the strategy, each matcher can explicitly be configured and supports the following configuration properties:</p></div><div class=ulist><ul><li><p><code>matching_strategy</code> - the type of the mathing strategy.</p></li><li><p><code>values</code> - the list of scope patterns</p></li></ul></div><div class=sect2><h3 id=_exact>Exact</h3><div class=paragraph><p>This the simplest matcher and is automatically selected, if just an array of strings is configured as shown in the following snippet:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>foo</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>bar</span></code></pre></div></div><div class=paragraph><p>However, as written in the <a href=#_scopes_matcher>Scopes Matcher</a> section, it can also explicitly be selected by setting <code>matching_strategy</code> to <code>exact</code> and defining the required scopes in the <code>values</code> property.</p></div><div class=exampleblock><div class=title>Example 13. Essentially same configurations</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>matching_strategy</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>exact</span>
<span style=color:#a6e22e>values</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>foo</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>bar</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml>  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>foo</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>bar</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_hierarchic>Hierarchic</h3><div class=paragraph><p>This matcher enables matching hierarchical scopes, which use <code>.</code> as separator. Imagine your system is organized that way, that it defines namespaces for different services like this:</p></div><div class=ulist><ul><li><p><code>my-service</code> being the top namespace</p></li><li><p><code>my-service.booking</code> - being the namespace of the booking service</p></li><li><p><code>my-service.orders</code> - being the namespace of the orders service</p></li><li><p><code>my-service.orders.partners</code> - being the namespace of the order service for partners and</p></li><li><p><code>my-service.orders.customers</code> - being the namespace of the order service for customers</p></li></ul></div><div class=paragraph><p>Basically you’ve established an identity for each of your services (this is comparable to how <a href=https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-id>SPIFFE IDs</a> are organized and also used for).</p></div><div class=paragraph><p>Now, imagine you use these namespaces as scope values to limit the usage of the issued tokens. In such situations the hierarchic scope matcher can become handy if you would like to assert any scope of the token must be in e.g. the <code>my-service</code> or the <code>my-service.orders</code> namespace.</p></div><div class=paragraph><p>This matcher can only be used by explicitly setting the <code>matching_strategy</code> to <code>hierarchic</code> and defining the required patterns in the <code>values</code> property.</p></div><div class=exampleblock><div class=title>Example 14. Matching of hierarchic scopes</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>matching_strategy</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>hierarchic</span>
<span style=color:#a6e22e>values</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>my-service</span></code></pre></div></div><div class=paragraph><p>This configuration will ensure all scopes withing the scope or scp claim are within the <code>my-service</code> namespace. So scope claim like</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=json><span style=color:#fff;background-color:#272822>{</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;scope&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#fff;background-color:#272822>[</span><span style=color:#e6db74>&#34;my-service.orders&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;my-service.orders.customers&#34;</span><span style=color:#fff;background-color:#272822>]</span><span style=color:#fff;background-color:#272822>
</span><span style=color:#fff;background-color:#272822>}</span></code></pre></div></div><div class=paragraph><p>would match, but</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=json><span style=color:#fff;background-color:#272822>{</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;scope&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#fff;background-color:#272822>[</span><span style=color:#e6db74>&#34;not-my-service&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;my-service.orders.customers&#34;</span><span style=color:#fff;background-color:#272822>]</span><span style=color:#fff;background-color:#272822>
</span><span style=color:#fff;background-color:#272822>}</span></code></pre></div></div><div class=paragraph><p>would not match.</p></div></div></div></div><div class=sect2><h3 id=_wildcard>Wildcard</h3><div class=paragraph><p>This matcher enables matching scopes using wildcards. It goes beyond the <a href=#_hierarchic>Hierarchic</a> scope matcher by enabling usage of wildcards.</p></div><div class=paragraph><p>This matcher can only be used by explicitly setting the <code>matching_strategy</code> to <code>wildcard</code> and defining the required patterns in the <code>values</code> property.</p></div></div></div></div><div class=sect1><h2 id=_subject>Subject</h2><div class=sectionbody><div class=paragraph><p>This configuration type enables extraction of subject information from responses received by Heimdall from authentication services. Following properties are available.</p></div><div class=ulist><ul><li><p><strong><code>id</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the id of the subject in the JSON object.</p></div></li><li><p><strong><code>attributes</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the attributes of the subject in the JSON object. Defaults to <code>@this</code>.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 15. Extracting subject id from an <a href=https://tools.ietf.org/html/rfc7662>OAuth2 Introspection</a> endpoint response.</div><div class=content><div class=paragraph><p>This example shows how to extract the subject id from an <a href=https://tools.ietf.org/html/rfc7662>OAuth2 Introspection</a> endpoint response and set the subject attributes to the entire response</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>sub</span>
<span style=color:#a6e22e>attributes</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#960050>@</span><span style=color:#e6db74>this</span></code></pre></div></div><div class=paragraph><p>Setting <code>attributes</code> was actually not required, as <code>@this</code> would be set by default anyway.</p></div></div></div><div class=exampleblock><div class=title>Example 16. Extracting subject id from an <a href=https://www.ory.sh/docs/kratos/>Ory Kratos</a> "whoami" endpoint response</div><div class=content><div class=paragraph><p>This example shows how to extract the subject id from an <a href=https://www.ory.sh/docs/kratos/>Ory Kratos</a> "whoami" endpoint response and set the subject attributes to the entire response. <code>attributes</code> is not configured, so default is used.</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>identity.id</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_session_lifespan>Session Lifespan</h2><div class=sectionbody><div class=paragraph><p>This configuration type enables the configuration of session lifespans, used for session validation for those authenticators, which act on non-standard protocols. Following properties are available.</p></div><div class=ulist><ul><li><p><strong><code>active</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the field describing the "active" status of the session in the corresponding JSON object. The actual value in that field should be convertable to a <code>bool</code> type. If not provided, or not found in the session object, the session is considered to be "active". "active" means it can be used and represent a valid session between the authentication system and the subject, the session has been issued to.</p></div></li><li><p><strong><code>issued_at</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the field in the corresponding JSON object, describing the time, when the session object has been issued. If not provided or not found, the issuance time is not considered during session validation.</p></div></li><li><p><strong><code>not_before</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the field in the corresponding JSON object describing the time, until which the session object is not allowed to be used. If not provided or not found, the corresponding time is not considered during session validation.</p></div></li><li><p><strong><code>not_after</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the field in the corresponding JSON object describing the time, after which the session object is not allowed to be used. If not provided or not found, the corresponding time is not considered during session validation.</p></div></li><li><p><strong><code>time_format</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>Since different authentication system use different representations for time strings, this property allows the definition of the <a href=https://pkg.go.dev/time#pkg-constants>time format/layout</a> used by the authentication system. Defaults to Unix Epoch time stamp.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>You can use the following <a href=https://go.dev/play/p/VjtvWMmp-Ua>Go Playground</a> link to test your time format settings.</td></tr></tbody></table></div></li><li><p><strong><code>validity_leeway</code></strong>: <a href=#_duration>Duration</a> (optional)</p><div class=paragraph><p>Enables definition of an allowed time drift between the authentication system and heimdall for the validation of the session validity. Defaults to 0.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 17. Making use of session information received from Ory’s Kratos</div><div class=content><div class=paragraph><p>A typical response from Kratos' <code>whoami</code> endpoint looks like follows (stripped to the most interesting parts):</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=json><span style=color:#fff;background-color:#272822>{</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;id&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;1338410d-c473-4503-a96a-53efa06e2531&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;active&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#66d9ef>true</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;expires_at&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;2021-10-15T15:58:57.683338Z&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;authenticated_at&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;2021-10-14T15:58:57.683338Z&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;issued_at&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;2021-10-14T15:58:57.683338Z&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;identity&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#fff;background-color:#272822>{</span><span style=color:#fff;background-color:#272822>
    </span><span style=color:#fff;background-color:#272822>&#34;id&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;9496bbd5-f426-473f-b087-c7df853f274a&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
    </span><span style=color:#960050>...</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>}</span><span style=color:#fff;background-color:#272822>
</span><span style=color:#fff;background-color:#272822>}</span></code></pre></div></div><div class=paragraph><p>To enable usage of these properties in Heimdall, you can configure the Session Lifespan as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>active</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>active</span>
<span style=color:#a6e22e>issued_at</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>issued_at</span>
<span style=color:#a6e22e>not_before</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>authenticated_at</span>
<span style=color:#a6e22e>not_after</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>expires_at</span>
<span style=color:#a6e22e>time_format</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>2006-01-02T15:04:05.999999Z07&#34;</span>
<span style=color:#a6e22e>validity_leeway</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>10s</span></code></pre></div></div></div></div><div class=exampleblock><div class=title>Example 18. Making use of session information received from a compliant OAuth2 authorization service</div><div class=content><div class=paragraph><p>A typical response from a token <code>introspection</code> endpoint looks like follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=json><span style=color:#fff;background-color:#272822>{</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;active&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#66d9ef>true</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;client_id&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;l238j323ds-23ij4&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;username&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;jdoe&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;scope&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;read write dolphin&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;sub&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;Z5O3upPC88QrAjx00dis&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;aud&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;https://protected.example.net/resource&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;iss&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;https://server.example.com/&#34;</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;exp&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#ae81ff>1419356238</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;iat&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#ae81ff>1419350238</span><span style=color:#fff;background-color:#272822>,</span><span style=color:#fff;background-color:#272822>
  </span><span style=color:#fff;background-color:#272822>&#34;extension_field&#34;</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822> </span><span style=color:#e6db74>&#34;twenty-seven&#34;</span><span style=color:#fff;background-color:#272822>
 </span><span style=color:#fff;background-color:#272822>}</span></code></pre></div></div><div class=paragraph><p>To enable usage of these properties in Heimdall, you can configure the Session Lifespan as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>active</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>active</span>
<span style=color:#a6e22e>issued_at</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>iat</span>
<span style=color:#a6e22e>not_after</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>exp</span>
<span style=color:#a6e22e>validity_leeway</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>10s</span></code></pre></div></div><div class=paragraph><p>As you see, there is no need to define the time format as the times values appearing in the responses from an introspection endpoint are Unix Epoch time stamps.</p></div></div></div></div></div></div><div class="d-flex justify-content-between"><a href=../../../../docs/configuration/pipeline/error_handlers/><div class="fs-6 mb-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-chevron-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5.0 010 .708L5.707 8l5.647 5.646a.5.5.0 01-.708.708l-6-6a.5.5.0 010-.708l6-6a.5.5.0 01.708.0z"/></svg>Error Handlers</div></a><a class=ms-auto href=../../../../docs/configuration/rules/overview/><div class="fs-6 mb-3">Rules Overview<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"/></svg></div></a></div></main></div><footer class="footer py-4 py-md-5 px-4 px-md-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../>Home</a></li><li class=mb-2><a href=../../../../docs/welcome>Docs</a></li><li class=mb-2><a href=../../../../openapi/>API</a></li><li class=mb-2><a href=../../../../docs/getting_started/concepts/>Get Started</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../docs/operations/install/>Install</a></li><li class=mb-2><a href=../../../../docs/guides/nginx/>NGINX Integration</a></li><li class=mb-2><a href=../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/issues>Issues</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/discussions>Discussions</a></li></ul></div></div></div></footer><script src=../../../../js/main.js defer></script></body></html>