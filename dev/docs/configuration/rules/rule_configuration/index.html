<!doctype html><html lang=en><head><title>Rule Definition</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Heimdall is an open source identity & access proxy (IAP) and access control decision API, designed for cloud native applications"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../../favicon.ico></head><body><header class="navbar navbar-expand-md navbar-dark bg-dark sticky-top"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand text-white" href=../../../../>Heimdall</a>
<button class=navbar-toggler type=button data-bs-toggle=offcanvas data-bs-target=#mainMenuContent aria-controls=mainMenuContent aria-expanded=false aria-label="Open main menu">
<span class=navbar-toggler-icon></span></button><div class="offcanvas offcanvas-end bg-dark" tabindex=-1 id=mainMenuContent data-bs-scroll=true aria-labelledby=mainMenuContentLabel><div class=offcanvas-header><h4 class="offcanvas-title text-white" id=mainMenuContentLabel>Heimdall</h4><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class=offcanvas-body><ul class="navbar-nav flex-column flex-md-row"><li class=nav-item><a class='nav-link text-white' href=../../../../docs/welcome>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../../openapi/>API</a></li><li class="nav-item dropdown"><a class='nav-link dropdown-toggle text-white' href=# id="Get Started-navbarDropdown" role=button data-bs-toggle=dropdown aria-expanded=false>Get Started</a><ul class="dropdown-menu bg-dark" aria-labelledby="Get Started-navbarDropdown"><li><a class='dropdown-item text-white' href=../../../../docs/getting_started/concepts/>Concepts</a></li><li><a class='dropdown-item text-white' href=../../../../docs/getting_started/decision_api_quickstart/>Decision API Quickstart</a></li><li><a class='dropdown-item text-white' href=../../../../docs/getting_started/proxy_quickstart/>Proxy Quickstart</a></li></ul></li></ul><hr class="text-white-50 d-md-none"><ul class="navbar-nav flex-column ms-auto"><doc-version-select class="nav-item dropdown" version-file=/heimdall/data.json current-version=dev current-page=/docs/configuration/rules/rule_configuration/><button class="btn btn-dark dropdown-toggle me-4" data-bs-toggle=dropdown aria-expanded=false>
dev</button></doc-version-select></ul><ul class="navbar-nav flex-column"><li class="nav-item mb-1"><a class="nav-link text-white" href=https://github.com/dadrus/heimdall><svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div></nav></header><nav class="navbar navbar-expand-lg bg-light" aria-label="Docs menu"><div class=container-xxl><doc-search index-file=/heimdall/dev/index.json path-prefix=/heimdall/dev><form id=docs-search tabindex=1 class="doks-search position-relative me-auto"><input id=search class="form-control search-bar" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=search-suggestions class="shadow bg-white rounded collapse search-results"></div></form></doc-search><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#docsMenuContent aria-controls=docsMenuContent aria-expanded=false aria-label="Open docs menu"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-arrow-down-up" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.5 15a.5.5.0 00.5-.5V2.707l3.146 3.147a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 10.708.708L11 2.707V14.5a.5.5.0 00.5.5zm-7-14a.5.5.0 01.5.5v11.793l3.146-3.147a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 01.708-.708L4 13.293V1.5a.5.5.0 01.5-.5z"/></svg></button><div class=d-md-none><div class="collapse navbar-collapse" id=docsMenuContent><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/welcome/>Welcome</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 aria-expanded=true>
Getting Started</button><div id=section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/concepts/>Concepts</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/decision_api_quickstart/>Decision API Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/proxy_quickstart/>Proxy Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/configuration_introduction/>Configuration Introduction</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a aria-expanded=true>
Operations</button><div id=section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/operations/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/cli/>CLI</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/observability/>Observability</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/security/>Security</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-929a28d261428029e61c0f81c6161fd71ba0b2fe aria-expanded=true>
Guides</button><div id=section-929a28d261428029e61c0f81c6161fd71ba0b2fe class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li><li class=nav-item><a class=nav-link href=../../../../docs/guides/nginx/>NGINX Integration</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 aria-expanded=true>
Configuration</button><div id=section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 class="collapse show"><ul class="nav flex-column"><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-5cbd584046863bc7b753e57e8681a98a87f36f0f aria-expanded=true>
Services</button><div id=section-5cbd584046863bc7b753e57e8681a98a87f36f0f class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/decision_api/>Decision API</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/proxy/>Proxy</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/management/>Management</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/configuration_types/>Common Configuration Options</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-e2397377af6d698b0fb66f53c47349a85bd2cb00 aria-expanded=true>
Observability</button><div id=section-e2397377af6d698b0fb66f53c47349a85bd2cb00 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/tracing/>Tracing</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a aria-expanded=true>
Pipeline Handler</button><div id=section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/overview/>Pipeline Overview</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/hydrators/>Hydrators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/mutators/>Mutators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/error_handlers/>Error Handlers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/configuration_types/>Configuration Types</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a aria-expanded=true>
Rules</button><div id=section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/overview/>Rules Overview</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/default_rule/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/rule_configuration/>Rule Definition</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/providers/>Rule Providers</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/signature_keys_and_certificates/>Signature Keys & Certificates</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-db1c784524e1b54011a95823026161f7c8517fe0 aria-expanded=true>
Reference</button><div id=section-db1c784524e1b54011a95823026161f7c8517fe0 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/reference/configuration/>Static Configuration</a></li></ul></div></li></ul></div></li></ul></div></div></div></nav><div class="container-xxl d-xxl-flex"><aside class="d-none d-md-block pe-4 pt-4 flex-xxl-shrink-0"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/welcome/>Welcome</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 aria-expanded=true>
Getting Started</button><div id=section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/concepts/>Concepts</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/decision_api_quickstart/>Decision API Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/proxy_quickstart/>Proxy Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/getting_started/configuration_introduction/>Configuration Introduction</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a aria-expanded=true>
Operations</button><div id=section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/operations/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/cli/>CLI</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/observability/>Observability</a></li><li class=nav-item><a class=nav-link href=../../../../docs/operations/security/>Security</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-929a28d261428029e61c0f81c6161fd71ba0b2fe aria-expanded=true>
Guides</button><div id=section-929a28d261428029e61c0f81c6161fd71ba0b2fe class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li><li class=nav-item><a class=nav-link href=../../../../docs/guides/nginx/>NGINX Integration</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 aria-expanded=true>
Configuration</button><div id=section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 class="collapse show"><ul class="nav flex-column"><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-5cbd584046863bc7b753e57e8681a98a87f36f0f aria-expanded=true>
Services</button><div id=section-5cbd584046863bc7b753e57e8681a98a87f36f0f class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/decision_api/>Decision API</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/proxy/>Proxy</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/management/>Management</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/configuration_types/>Common Configuration Options</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-e2397377af6d698b0fb66f53c47349a85bd2cb00 aria-expanded=true>
Observability</button><div id=section-e2397377af6d698b0fb66f53c47349a85bd2cb00 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/tracing/>Tracing</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a aria-expanded=true>
Pipeline Handler</button><div id=section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/overview/>Pipeline Overview</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/hydrators/>Hydrators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/mutators/>Mutators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/error_handlers/>Error Handlers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/configuration_types/>Configuration Types</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a aria-expanded=true>
Rules</button><div id=section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/overview/>Rules Overview</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/default_rule/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/rule_configuration/>Rule Definition</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/providers/>Rule Providers</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/signature_keys_and_certificates/>Signature Keys & Certificates</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-db1c784524e1b54011a95823026161f7c8517fe0 aria-expanded=true>
Reference</button><div id=section-db1c784524e1b54011a95823026161f7c8517fe0 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/reference/configuration/>Static Configuration</a></li></ul></div></li></ul></div></li></ul></aside><main class="px-3 pt-4 flex-xxl-grow-0"><h1>Rule Definition</h1><div><div class=paragraph><p>Rules are the heart of heimdall. These allow execution of arbitrary logic, required by your upstream service. This section describes everything related to the configuration of a particular rule and how can these be combined to rule sets, which can then be loaded by a <a href=../../../../docs/configuration/rules/providers/>rule provider</a>.</p></div><div class=sect1><h2 id=_rule_configuration>Rule Configuration</h2><div class=sectionbody><div class=paragraph><p>A single rule consists of the following properties:</p></div><div class=ulist><ul><li><p><strong><code>id</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The unique identifier of a rule. It must be unique across all rules. To ensure this it is recommended to let the <code>id</code> include the name of your upstream service, as well as its purpose. E.g. <code>rule:my-service:public-api</code>.</p></div></li><li><p><strong><code>url</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>Glob or Regex pattern of the endpoints of your upstream service, which this rule should apply to. Query parameters are ignored.</p></div></li><li><p><strong><code>matching_strategy</code></strong>: <em><a href=#_matching_strategy>Matching Strategy</a></em> (optional)</p><div class=paragraph><p>Which strategy to use for matching of the value, provided in the <code>url</code> property. Can be <code>glob</code> or <code>regex</code>. Defaults to <code>glob</code>.</p></div></li><li><p><strong><code>methods</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>Which HTTP methods (<code>GET</code>, <code>POST</code>, <code>PATCH</code>, etc) are allowed for the matched URL. If not specified, every request to that URL will result in <code>405 Method Not Allowed</code> response from Heimdall.</p></div></li><li><p><strong><code>upstream</code></strong>: <em>string</em> (mandatory in Proxy operation mode)</p><div class=paragraph><p>Defines where to forward the proxied request to. Used only when Heimdall is operated in the Proxy operation mode. Only the URL schema and the host parts are used if this property is specified.</p></div></li><li><p><strong><code>execute</code></strong>: <em><a href=#_regular_pipeline>Regular Pipeline</a></em> (mandatory)</p><div class=paragraph><p>Which handlers to use to authenticate, authorize, hydrate (enrich) and mutate the subject of the request.</p></div></li><li><p><strong><code>on_error</code></strong>: <em><a href=#_error_handler_pipeline>Error Handler Pipeline</a></em> (optional)</p><div class=paragraph><p>Which error handlers to use if any of the handlers, defined in the <code>execute</code> property, fails. This property is optional only, if a <a href=../../../../docs/configuration/rules/default_rule/>default rule</a> has been configured and contains an <code>on_error</code> definition.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 1. An example rule</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>rule:foo:bar</span>
<span style=color:#a6e22e>url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>http://my-service.local/&lt;**&gt;</span>
<span style=color:#a6e22e>upstream</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>http://backend-a:8080</span>
<span style=color:#a6e22e>methods</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>GET</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#e6db74>POST</span>
<span style=color:#a6e22e>execute</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>authenticator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>authorizer</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>hydrator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>mutator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>zab</span>
<span style=color:#a6e22e>on_error</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>error_handler</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foobar</span></code></pre></div></div></div></div><div class=sect2><h3 id=_matching_strategy>Matching Strategy</h3><div class=paragraph><p>Matching strategies are used to match the <code>url</code> patterns in rules and explicitly set by making use of <code>matching_strategy</code> rule property. Following strategies are available:</p></div><div class=ulist><ul><li><p><code>regex</code> - to match <code>url</code> expressions by making use of regular expressions.</p></li><li><p><code>glob</code> - to match <code>url</code> expressions by making use of glob expressions.</p></li></ul></div><div class=paragraph><p>Heimdall uses <a href=https://github.com/dlclark/regexp2>dlclark/regexp2</a> and <a href=https://github.com/gobwas/glob>gobwas/glob</a> to match <code>regex</code> expressions, respectively <code>glob</code> expressions. Head over to linked resources to get more insights about possible options for expression definitions.</p></div><div class=exampleblock><div class=title>Example 2. Regular expressions patterns</div><div class=content><div class=ulist><ul><li><p><code>https://mydomain.com/</code> matches <code>https://mydomain.com/</code> and doesn’t match <code>https://mydomain.com/foo</code> or <code>https://mydomain.com</code>.</p></li><li><p><code>&lt;https|http>://mydomain.com/&lt;.*></code> matches <code>https://mydomain.com/</code> and <code>http://mydomain.com/foo</code>. Doesn’t match <code>https://other-domain.com/</code> or <code>https://mydomain.com</code>.</p></li><li><p><code>http://mydomain.com/&lt;[:digit:]+></code> matches <code>http://mydomain.com/123</code>, but doesn’t match <code>http://mydomain/abc</code>.</p></li><li><p><code>http://mydomain.com/&lt;(?!protected).*></code> matches <code>http://mydomain.com/resource</code>, but doesn’t match <code>http://mydomain.com/protected</code>.</p></li></ul></div></div></div><div class=exampleblock><div class=title>Example 3. Glob patterns</div><div class=content><div class=ulist><ul><li><p><code>https://mydomain.com/&lt;m?n></code> matches <code>https://mydomain.com/man</code> and does not match <code>http://mydomain.com/foo</code>.</p></li><li><p><code>https://mydomain.com/&lt;{foo*,bar*}></code> matches <code>https://mydomain.com/foo</code> or <code>https://mydomain.com/bar</code> and doesn’t match <code>https://mydomain.com/any</code>.</p></li></ul></div></div></div></div><div class=sect2><h3 id=_regular_pipeline>Regular Pipeline</h3><div class=paragraph><p>As described in the <a href=../../../../docs/getting_started/concepts/>Concepts</a> section, Heimdall’s decision pipeline consists of multiple steps - at least consisting of <a href=../../../../docs/configuration/pipeline/authenticators/>authenticators</a> and <a href=../../../../docs/configuration/pipeline/mutators/>mutators</a>. The definition of such a pipeline happens as a list of required types with the corresponding ids (previously defined in Heimdall’s <a href=../../../../docs/configuration/pipeline/overview/>Pipeline</a> configuration), in the following order:</p></div><div class=ulist><ul><li><p>List of <a href=../../../../docs/configuration/pipeline/authenticators/>authenticators</a> using <code>authenticator</code> as key, followed by the required authenticator <code>id</code>. Authenticators following the first defined in the list are used by Heimdall as fallback. That is, if first authenticator fails due to missing authentication data, second is executed, etc. Fallback is not used if an authenticator fails due to validation errors of the given authentication data. E.g. if an authenticator fails to validate the signature of a JWT token, the next authenticator in the list will not be executed. Instead, the entire pipeline will fail and lead to the execution of the <a href=#_error_handler_pipeline>error handler pipeline</a>. This list is mandatory if no <a href=../../../../docs/configuration/rules/default_rule/>default rule</a> is configured.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>Some authenticators use the same sources to get subject authentication object from. E.g. the <code>jwt</code> and the <code>oauth2_introspection</code> authenticators can retrieve tokens from the same places in the request. If such authenticators are used in the same pipeline, you should configure the more specific ones before the more general ones to have working default fallbacks. To stay with the above example, the <code>jwt</code> authenticator is more specific compared to <code>oauth2_introspection</code>, as it will be only executed, if the token is in a JWT format. In contrast to this, the <code>oauth2_introspection</code> authenticator is more general and does not care about the token format, thus will feel responsible for the request as soon as it finds a bearer token. You can however also make use of the <code>allow_fallback_on_error</code> configuration property and set it to <code>true</code>. This will allow a fallback even if the verification of the credentials fail.</td></tr></tbody></table></div></li><li><p>List of <a href=(/docs/configuration/pipeline/hydrators/>hydrators</a> and <a href=(/docs/configuration/pipeline/authorizers/>authorizers</a> in any order (optional). Can also be mixed. As with authenticators, the list definition happens using either <code>hydrator</code> or <code>authorizer</code> as key, followed by the required <code>id</code>. All handlers in this list are executed in the order, they are defined. If any of these fails, the entire pipeline fails, which leads to the execution of the <a href=#_error_handler_pipeline>error handler pipeline</a>. This list is optional.</p></li><li><p>List <a href=../../../../docs/configuration/pipeline/mutators/>mutators</a> using <code>mutator</code> as key, followed by the required mutator <code>id</code>. All mutators in this list are executed in the order, they are defined. If any of these fails, the entire pipeline fails, which leads to the execution of the <a href=#_error_handler_pipeline>error handler pipeline</a>. This list is mandatory if no <a href=../../../../docs/configuration/rules/default_rule/>default rule</a> is configured.</p></li></ul></div><div class=paragraph><p>In all cases, parts of the used pipeline type configurations can be overridden if supported by the corresponding pipeline type. Overriding has no effect on the handler prototypes defined in Heimdall’s <a href=../../../../docs/configuration/pipeline/overview/>Pipeline</a> configuration. Overrides are always local to the given rule. With other words, you can adjust your rule specific pipeline as you want without any side effects.</p></div><div class=exampleblock><div class=title>Example 4. Complex pipeline</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#75715e># list of authenticators</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>authenticator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>authenticator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
  <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>subject</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>anon</span>
  <span style=color:#75715e># ... any further required authenticator</span>
<span style=color:#75715e># list of authorizers and hydrators in any order</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>hydrator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>baz</span>
  <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>cache_ttl</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>0s</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>authorizer</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>zab</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>hydrator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>hydrator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>authorizer</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
  <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>script</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>|</span>
      <span style=color:#e6db74>// some script logic deviating from the definition in the pipeline configuration.</span>
  <span style=color:#75715e># ... any further required authorizer or hydrator</span>
<span style=color:#75715e># list of mutators</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>mutator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>mutator</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
  <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>headers</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>X-User-ID</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>{{</span> <span style=color:#fff;background-color:#272822>quote .ID</span> <span style=color:#fff;background-color:#272822>}}</span>
  <span style=color:#75715e># ... any further required mutators</span></code></pre></div></div><div class=paragraph><p>This example uses</p></div><div class=ulist><ul><li><p>two authenticators, with authenticator named <code>bar</code> being the fallback for the authenticator named <code>foo</code>. This fallback authenticator is obviously of type <a href=../../../../docs/configuration/pipeline/authenticators/#_anonymous>anonymous</a> as it reconfigures the referenced prototype to use <code>anon</code> for subject id.</p></li><li><p>multiple hydrators and authorizers, with first hydrator having its cache disabled (<code>cache_ttl</code> set to 0s) and the last authorizer being of type <a href=../../../../docs/configuration/pipeline/authorizers/#_local>local</a> as it reconfigures the referenced prototype to use a different authorization script.</p></li><li><p>two mutators, with the second one being obviously of type <a href=../../../../docs/configuration/pipeline/mutators/#_header>header</a>, as it defines a <code>X-User-ID</code> header set to the value of the subject id to be forwarded to the upstream service.</p></li></ul></div></div></div></div><div class=sect2><h3 id=_error_handler_pipeline>Error Handler Pipeline</h3><div class=paragraph><p>Compared to the <a href=#_regular_pipeline>Regular Pipeline</a>, the error handler pipeline is pretty simple. It is also a list of handlers, but all referenced handler types are <a href=../../../../docs/configuration/pipeline/error_handlers/>error handler types</a>. Thus, each entry in this list must have <code>error_handler</code> as key, followed by the <code>ìd</code> of the required error handler, previously defined in Heimdall’s <a href=../../../../docs/configuration/pipeline/overview/>Pipeline</a> configuration. Error handlers are always executed as fallbacks. So, if the condition of the first error handler does not match, second is selected, if its condition matches, it is executed, otherwise the next one is selected, etc. If none of the conditions of the defined error handlers match, the <a href=../../../../docs/configuration/pipeline/error_handlers/#_default>default error handler</a> is executed.</p></div><div class=paragraph><p>As with the regular pipeline, parts of the used error handler configurations can be overridden if supported by the corresponding type. Overriding has no effect on the handler prototypes defined in Heimdall’s <a href=../../../../docs/configuration/pipeline/overview/>Pipeline</a> configuration. Overrides are always local to the given rule. With other words, you can adjust your rule specific pipeline as you want without any side effects.</p></div><div class=exampleblock><div class=title>Example 5. Two error handlers</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>error_handler</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foo</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>error_handler</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>bar</span>
  <span style=color:#a6e22e>config</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>when</span><span style=color:#fff;background-color:#272822>:</span>
      <span style=color:#75715e># rule specific conditions</span></code></pre></div></div></div></div><div class=paragraph><p>This example uses two error handlers, named <code>foo</code> and <code>bar</code>. <code>bar</code> will only be selected by Heimdall if <code>foo</code> 's error condition (defined in Heimdall’s <a href=../../../../docs/configuration/pipeline/overview/>Pipeline</a> configuration) does not match. <code>bar</code> does also override the default condition, defined by the prototype to the one required, by the given rule.</p></div></div></div></div><div class=sect1><h2 id=_rule_set>Rule Set</h2><div class=sectionbody><div class=paragraph><p>A rule set is just a list of rules, typically defined in a format specified by a particular <a href=(/docs/configuration/rules/providers/>provider</a>. In its simplest case, a rule set does not require further configuration options and can look like shown below:</p></div><div class=exampleblock><div class=title>Example 6. Rule set with two rules</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>rule:1</span>
  <span style=color:#a6e22e>url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>https://my-service1.local/&lt;**&gt;</span>
  <span style=color:#a6e22e>methods</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>[</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>GET&#34;</span> <span style=color:#fff;background-color:#272822>]</span>
  <span style=color:#a6e22e>execute</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>authorizer</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>foobar</span>
<span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>id</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>rule:2</span>
  <span style=color:#a6e22e>url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>https://my-service2.local/&lt;**&gt;</span>
  <span style=color:#a6e22e>methods</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#fff;background-color:#272822>[</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>GET&#34;</span> <span style=color:#fff;background-color:#272822>]</span>
  <span style=color:#a6e22e>execute</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#fff;background-color:#272822>-</span> <span style=color:#a6e22e>authorizer</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>barfoo</span></code></pre></div></div></div></div></div></div></div><div class="d-flex justify-content-between"><a href=../../../../docs/configuration/rules/default_rule/><div class="fs-6 mb-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-chevron-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5.0 010 .708L5.707 8l5.647 5.646a.5.5.0 01-.708.708l-6-6a.5.5.0 010-.708l6-6a.5.5.0 01.708.0z"/></svg>Default Rule</div></a><a class=ms-auto href=../../../../docs/configuration/rules/providers/><div class="fs-6 mb-3">Rule Providers<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"/></svg></div></a></div></main></div><footer class="footer py-4 py-md-5 px-4 px-md-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../>Home</a></li><li class=mb-2><a href=../../../../docs/welcome>Docs</a></li><li class=mb-2><a href=../../../../openapi/>API</a></li><li class=mb-2><a href=../../../../docs/getting_started/concepts/>Get Started</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../docs/operations/install/>Install</a></li><li class=mb-2><a href=../../../../docs/guides/nginx/>NGINX Integration</a></li><li class=mb-2><a href=../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/issues>Issues</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/discussions>Discussions</a></li></ul></div></div></div></footer><script src=../../../../js/bootstrap.bundle.js defer></script>
<script src=../../../../js/main.js defer></script></body></html>