<!doctype html><html lang=en><head><title>NGINX Integration</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Heimdall is an open source identity & access proxy (IAP) and access control decision API, designed for cloud native applications"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../favicon.ico></head><body><header class="navbar navbar-expand-md navbar-dark bg-dark sticky-top"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand text-white" href=../../../>Heimdall</a>
<button class=navbar-toggler type=button data-bs-toggle=offcanvas data-bs-target=#mainMenuContent aria-controls=mainMenuContent aria-expanded=false aria-label="Open main menu">
<span class=navbar-toggler-icon></span></button><div class="offcanvas offcanvas-end bg-dark" tabindex=-1 id=mainMenuContent data-bs-scroll=true aria-labelledby=mainMenuContentLabel><div class=offcanvas-header><h4 class="offcanvas-title text-white" id=mainMenuContentLabel>Heimdall</h4><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class=offcanvas-body><ul class="navbar-nav flex-column flex-md-row"><li class=nav-item><a class='nav-link text-white' href=../../../docs/welcome>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../docs/api/>API</a></li><li class="nav-item dropdown"><a class='nav-link dropdown-toggle text-white' href=# id="Getting Started-navbarDropdown" role=button data-bs-toggle=dropdown aria-expanded=false>Getting Started</a><ul class="dropdown-menu bg-dark" aria-labelledby="Getting Started-navbarDropdown"><li><a class='dropdown-item text-white' href=../../../docs/getting_started/concepts/>Concepts</a></li><li><a class='dropdown-item text-white' href=../../../docs/getting_started/decision_api_quickstart/>Decision API Quickstart</a></li><li><a class='dropdown-item text-white' href=../../../docs/getting_started/proxy_quickstart/>Proxy Quickstart</a></li></ul></li></ul><hr class="text-white-50 d-md-none"><ul class="navbar-nav flex-column ms-auto"><li class="nav-item mb-1"><a class="nav-link text-white" href=https://github.com/dadrus/heimdall><svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div></nav></header><nav class="navbar navbar-expand-lg bg-light d-md-none" aria-label="Docs menu"><div class=container-xxl><span>Docs menu</span>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#docsMenuContent aria-controls=docsMenuContent aria-expanded=false aria-label="Open docs menu"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-arrow-down-up" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.5 15a.5.5.0 00.5-.5V2.707l3.146 3.147a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 10.708.708L11 2.707V14.5a.5.5.0 00.5.5zm-7-14a.5.5.0 01.5.5v11.793l3.146-3.147a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 01.708-.708L4 13.293V1.5a.5.5.0 01.5-.5z"/></svg></button><div class="collapse navbar-collapse" id=docsMenuContent><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/welcome/>Welcome</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 aria-expanded=true>
Getting Started</button><div id=section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/getting_started/concepts/>Concepts</a></li><li class=nav-item><a class=nav-link href=../../../docs/getting_started/decision_api_quickstart/>Decision API Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../docs/getting_started/proxy_quickstart/>Proxy Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../docs/getting_started/configuration_introduction/>Configuration Introduction</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a aria-expanded=true>
Operations</button><div id=section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/operations/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../docs/operations/cli/>CLI</a></li><li class=nav-item><a class=nav-link href=../../../docs/operations/observability/>Observability</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-929a28d261428029e61c0f81c6161fd71ba0b2fe aria-expanded=true>
Guides</button><div id=section-929a28d261428029e61c0f81c6161fd71ba0b2fe class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/guides/traefik/>Traefik Proxy Integration</a></li><li class=nav-item><a class=nav-link href=../../../docs/guides/nginx/>NGINX Integration</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../docs/api/>API</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 aria-expanded=true>
Configuration</button><div id=section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 class="collapse show"><ul class="nav flex-column"><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-5cbd584046863bc7b753e57e8681a98a87f36f0f aria-expanded=true>
Services</button><div id=section-5cbd584046863bc7b753e57e8681a98a87f36f0f class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/services/decision_api/>Decision API</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/services/proxy/>Proxy</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/services/management/>Management</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/services/configuration_types/>Common Configuration Options</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-e2397377af6d698b0fb66f53c47349a85bd2cb00 aria-expanded=true>
Observability</button><div id=section-e2397377af6d698b0fb66f53c47349a85bd2cb00 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/observability/tracing/>Tracing</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a aria-expanded=true>
Pipeline Handler</button><div id=section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/overview/>Pipeline Overview</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/hydrators/>Hydrators</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/mutators/>Mutators</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/error_handlers/>Error Handlers</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/configuration_types/>Configuration Types</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a aria-expanded=true>
Rules</button><div id=section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/rules/overview/>Rules Overview</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/rules/default_rule/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/rules/rule_configuration/>Rule Definition</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/rules/providers/>Rule Providers</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-db1c784524e1b54011a95823026161f7c8517fe0 aria-expanded=true>
Reference</button><div id=section-db1c784524e1b54011a95823026161f7c8517fe0 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/reference/configuration/>Static Configuration</a></li></ul></div></li></ul></div></li></ul></div></div></nav><div class="container-xxl d-xxl-flex"><aside class="d-none d-md-block pe-4 pt-4 flex-xxl-shrink-0"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/welcome/>Welcome</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 aria-expanded=true>
Getting Started</button><div id=section-010b85ad56b34c34c7c2a3b2436c740e30428ed5 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/getting_started/concepts/>Concepts</a></li><li class=nav-item><a class=nav-link href=../../../docs/getting_started/decision_api_quickstart/>Decision API Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../docs/getting_started/proxy_quickstart/>Proxy Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../docs/getting_started/configuration_introduction/>Configuration Introduction</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a aria-expanded=true>
Operations</button><div id=section-a1fdaa6b2a846c8fcf18d414bf8c61db610eda6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/operations/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../docs/operations/cli/>CLI</a></li><li class=nav-item><a class=nav-link href=../../../docs/operations/observability/>Observability</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-929a28d261428029e61c0f81c6161fd71ba0b2fe aria-expanded=true>
Guides</button><div id=section-929a28d261428029e61c0f81c6161fd71ba0b2fe class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/guides/traefik/>Traefik Proxy Integration</a></li><li class=nav-item><a class=nav-link href=../../../docs/guides/nginx/>NGINX Integration</a></li></ul></div></li><li class=nav-item><a class=nav-link href=../../../docs/api/>API</a></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 aria-expanded=true>
Configuration</button><div id=section-754164850f38c1ecdaf6b8ed894cb192bc36c5f4 class="collapse show"><ul class="nav flex-column"><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-5cbd584046863bc7b753e57e8681a98a87f36f0f aria-expanded=true>
Services</button><div id=section-5cbd584046863bc7b753e57e8681a98a87f36f0f class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/services/decision_api/>Decision API</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/services/proxy/>Proxy</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/services/management/>Management</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/services/configuration_types/>Common Configuration Options</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-e2397377af6d698b0fb66f53c47349a85bd2cb00 aria-expanded=true>
Observability</button><div id=section-e2397377af6d698b0fb66f53c47349a85bd2cb00 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/observability/tracing/>Tracing</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a aria-expanded=true>
Pipeline Handler</button><div id=section-312012dc6ebfc0a65762f202c68d0adaab7cfe6a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/overview/>Pipeline Overview</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/hydrators/>Hydrators</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/mutators/>Mutators</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/error_handlers/>Error Handlers</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/pipeline/configuration_types/>Configuration Types</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a aria-expanded=true>
Rules</button><div id=section-bb11a8e3f8712e36e7cd9d1c615a4e3dbb03336a class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/rules/overview/>Rules Overview</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/rules/default_rule/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/rules/rule_configuration/>Rule Definition</a></li><li class=nav-item><a class=nav-link href=../../../docs/configuration/rules/providers/>Rule Providers</a></li></ul></div></li><li class=nav-item><button class="btn btn-toggle align-items-center rounded collapsed fw-bold border-0" data-bs-toggle=collapse data-bs-target=#section-db1c784524e1b54011a95823026161f7c8517fe0 aria-expanded=true>
Reference</button><div id=section-db1c784524e1b54011a95823026161f7c8517fe0 class="collapse show"><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../docs/configuration/reference/configuration/>Static Configuration</a></li></ul></div></li></ul></div></li></ul></aside><main class="px-3 pt-4 flex-xxl-grow-0"><h1>NGINX Integration</h1><div><div class=paragraph><p><a href=https://nginx.org/>NGINX</a> is an HTTP and reverse proxy server which became famous as one of the fastest web servers out there, heimdall can be integrated with by making use of the <a href=https://nginx.org/en/docs/http/ngx_http_auth_request_module.html>ngx_http_auth_request_module</a>. In such setup, NGINX delegates authentication and authorization to heimdall. If heimdall answers with a 2XX code, NGINX grants access and forwards the original request to the upstream service. If heimdall returns 401 or 403, the access is denied with the corresponding error code. Any other response code returned by heimdall is considered an error.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>If there is no matching rule on heimdall side, heimdall responds with <code>404 Not Found</code>, which, as said above will be treated by NGINX as error. To avoid such situations, you can define a <a href=../../../docs/configuration/rules/default_rule/>default rule</a>, which is anyway recommended to have secure defaults, which, depending on the configuration, would then respond either with 401 or 403.</td></tr></tbody></table></div><div class=paragraph><p>Since NGINX is highly configurable and heimdall supports different integration options, you can use any of the configuration examples given below. All of these enable heimdall to build the URL of the protected backend server for rule matching purposes.</p></div><div class=paragraph><p>In most cases you must configure heimdall to trust your NGINX instances by setting <a href=../../../docs/configuration/services/decision_api/#_trusted_proxies><code>trusted_proxies</code></a> for the Decision service. Exceptions are described in the sections below.</p></div><div class=sect1><h2 id=_first_option>Forward only the host information in the header</h2><div class=sectionbody><div class=paragraph><p>With this method you set the <code>X-Forwarded-Host</code> to let heimdall know the backend host. All other URL parts (schema, path and query parameter) as well as the HTTP method are then inferred from the URL heimdall receives the request on.</p></div><div class=paragraph><p>Instead of using <code>X-Forwarded-Host</code> you could also make use of the <code>Host</code> header. In that case, there is no need to configure the <code>trusted_proxies</code>.</p></div><div class=exampleblock><div class=title>Example 1. Possible Configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=nginx><span style=color:#75715e># nginx.conf</span>
<span style=color:#f92672>...</span>

<span style=color:#e6db74>location</span> <span style=color:#fff;background-color:#272822>/</span> <span style=color:#fff;background-color:#272822>{</span>
  <span style=color:#f92672>auth_request</span>            <span style=color:#fff;background-color:#272822>/_auth</span><span style=color:#fff;background-color:#272822>;</span>                                    <i class=conum data-value=1></i><b>(1)</b>
  <span style=color:#f92672>auth_request_set</span>        <span style=color:#fff;background-color:#272822>$auth_cookie</span> <span style=color:#fff;background-color:#272822>$upstream_http_set_cookie</span><span style=color:#fff;background-color:#272822>;</span>    <i class=conum data-value=2></i><b>(2)</b>
  <span style=color:#f92672>add_header</span>              <span style=color:#e6db74>Set-Cookie</span> <span style=color:#fff;background-color:#272822>$auth_cookie</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>auth_request_set</span>        <span style=color:#fff;background-color:#272822>$authHeader0</span> <span style=color:#fff;background-color:#272822>$upstream_http_authorization</span><span style=color:#fff;background-color:#272822>;</span> <i class=conum data-value=3></i><b>(3)</b>
  <span style=color:#f92672>proxy_set_header</span>        <span style=color:#e6db74>&#39;Authorization&#39;</span> <span style=color:#fff;background-color:#272822>$authHeader0</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#75715e># mitigate HTTPoxy Vulnerability</span>
  <span style=color:#75715e># https://www.nginx.com/blog/mitigating-the-httpoxy-vulnerability-with-nginx/</span>
  <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Proxy</span>  <span style=color:#e6db74>&#34;&#34;</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>...</span>
<span style=color:#960050>}</span>

<span style=color:#e6db74>location</span> <span style=color:#fff;background-color:#272822>=</span> <span style=color:#fff;background-color:#272822>/_auth</span> <span style=color:#fff;background-color:#272822>{</span>                                          <i class=conum data-value=4></i><b>(4)</b>
  <span style=color:#f92672>internal</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>proxy_pass</span>               <span style=color:#e6db74>http://heimdall:4456</span><span style=color:#fff;background-color:#272822>$request_uri</span><span style=color:#fff;background-color:#272822>;</span> <i class=conum data-value=5></i><b>(5)</b>
  <span style=color:#f92672>proxy_pass_request_body</span>  <span style=color:#66d9ef>off</span><span style=color:#fff;background-color:#272822>;</span>                              <i class=conum data-value=6></i><b>(6)</b>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>Content-Length</span>   <span style=color:#e6db74>&#34;&#34;</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-Host</span> <span style=color:#fff;background-color:#272822>$http_host</span><span style=color:#fff;background-color:#272822>;</span>      <i class=conum data-value=7></i><b>(7)</b>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-For</span>  <span style=color:#fff;background-color:#272822>$remote_addr</span><span style=color:#fff;background-color:#272822>;</span>    <i class=conum data-value=8></i><b>(8)</b>
<span style=color:#fff;background-color:#272822>}</span></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Configures NGINX to forward every request to the internal <code>/_auth</code> endpoint (this is where the actual heimdall integration happens - see below).</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>When the request to heimdall returns, this and the next line set the Cookies set by heimdall in the response (whether you need this depends on your <a href=../../../docs/configuration/pipeline/hydrators/>Hydrators</a> and <a href=../../../docs/configuration/pipeline/mutators/>Mutators</a> configuration)</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>When the request to heimdall returns, this and the next line set the <code>Authorization</code> header set by heimdall in the response (which header to set depends again on your <a href=../../../docs/configuration/pipeline/hydrators/>Hydrators</a> and <a href=../../../docs/configuration/pipeline/mutators/>Mutators</a> configuration)</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>This is where the "magic" happens</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Configures NGINX to pass the request to heimdall and sets the request path and queries from the original request</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>Disables sending of the request body. If your heimdall rules make use of the body, you should set this to <code>on</code> and remove the next line.</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>This is where you forward the host information to heimdall</td></tr><tr><td><i class=conum data-value=8></i><b>8</b></td><td>Not really required, but makes the remote address available to heimdall and thus to the rules. Requires <code>trusted_proxies</code> to be configured.</td></tr></tbody></table></div></div></div></div></div><div class=sect1><h2 id=_second_option>Forward all information in <code>X-Forwarded-*</code> headers</h2><div class=sectionbody><div class=paragraph><p>With this method you set the <code>X-Forwarded-Method</code>, <code>X-Forwarded-Proto</code>, <code>X-Forwarded-Host</code> and <code>X-Forwarded-Path</code> to let heimdall know the backend url and the required HTTP method.</p></div><div class=paragraph><p>Compared to the <a href=#_first_option>previous integration</a> option, the configuration only differs in the definition of the internal <code>/_auth</code> endpoint. So, the example configuration is limited to that part only.</p></div><div class=exampleblock><div class=title>Example 2. Possible Configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=nginx><span style=color:#75715e># nginx.conf</span>
<span style=color:#f92672>...</span>

<span style=color:#e6db74>location</span> <span style=color:#fff;background-color:#272822>=</span> <span style=color:#fff;background-color:#272822>/_auth</span> <span style=color:#fff;background-color:#272822>{</span>
  <span style=color:#f92672>internal</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>proxy_pass</span>               <span style=color:#e6db74>http://heimdall:4456</span><span style=color:#fff;background-color:#272822>;</span>                    <i class=conum data-value=1></i><b>(1)</b>
  <span style=color:#f92672>proxy_pass_request_body</span>  <span style=color:#66d9ef>off</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>Content-Length</span>         <span style=color:#e6db74>&#34;&#34;</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-Method</span>     <span style=color:#fff;background-color:#272822>$request_method</span><span style=color:#fff;background-color:#272822>;</span>  <i class=conum data-value=2></i><b>(2)</b>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-Proto</span>      <span style=color:#fff;background-color:#272822>$scheme</span><span style=color:#fff;background-color:#272822>;</span>          <i class=conum data-value=3></i><b>(3)</b>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-Host</span>       <span style=color:#fff;background-color:#272822>$http_host</span><span style=color:#fff;background-color:#272822>;</span>       <i class=conum data-value=4></i><b>(4)</b>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-Path</span>       <span style=color:#fff;background-color:#272822>$request_uri</span><span style=color:#fff;background-color:#272822>;</span>     <i class=conum data-value=5></i><b>(5)</b>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-For</span>        <span style=color:#fff;background-color:#272822>$remote_addr</span><span style=color:#fff;background-color:#272822>;</span>
<span style=color:#fff;background-color:#272822>}</span></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Configures NGINX to pass the request to heimdall.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Let NGINX forward the used HTTP method to heimdall.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Let NGINX forward the used HTTP schema to heimdall.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Let NGINX forward the used host to heimdall.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Let NGINX forward the used path and query parameter to heimdall.</td></tr></tbody></table></div></div></div></div></div><div class=sect1><h2 id=_third_option>Forward all information in <code>X-Forwarded-Uri</code> and <code>X-Forwarded-Method</code> headers</h2><div class=sectionbody><div class=paragraph><p>This method is a simplified alternative to the <a href=#_second_option>previous</a> one in which heimdall receives everything required to know the backend url and the HTTP method in HTTP headers.</p></div><div class=paragraph><p>The difference is again in the definition of the internal <code>/_auth</code> endpoint. So, the example configuration is limited to that part.</p></div><div class=exampleblock><div class=title>Example 3. Possible Configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=nginx><span style=color:#75715e># nginx.conf</span>
<span style=color:#f92672>...</span>

<span style=color:#e6db74>location</span> <span style=color:#fff;background-color:#272822>=</span> <span style=color:#fff;background-color:#272822>/_auth</span> <span style=color:#fff;background-color:#272822>{</span>
  <span style=color:#f92672>internal</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>proxy_pass</span>               <span style=color:#e6db74>http://heimdall:4456</span><span style=color:#fff;background-color:#272822>;</span>                                    <i class=conum data-value=1></i><b>(1)</b>
  <span style=color:#f92672>proxy_pass_request_body</span>  <span style=color:#66d9ef>off</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>Content-Length</span>         <span style=color:#e6db74>&#34;&#34;</span><span style=color:#fff;background-color:#272822>;</span>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-Method</span>     <span style=color:#fff;background-color:#272822>$request_method</span><span style=color:#fff;background-color:#272822>;</span>                  <i class=conum data-value=2></i><b>(2)</b>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-Uri</span>        <span style=color:#fff;background-color:#272822>$scheme</span><span style=color:#fff;background-color:#272822>:</span><span style=color:#fff;background-color:#272822>//</span><span style=color:#fff;background-color:#272822>$http_host$request_uri</span><span style=color:#fff;background-color:#272822>;</span> <i class=conum data-value=3></i><b>(3)</b>
  <span style=color:#f92672>proxy_set_header</span>         <span style=color:#e6db74>X-Forwarded-For</span>        <span style=color:#fff;background-color:#272822>$remote_addr</span><span style=color:#fff;background-color:#272822>;</span>
<span style=color:#fff;background-color:#272822>}</span></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Configures NGINX to pass the request to heimdall.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Let NGINX forward the used HTTP method to heimdall.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Let NGINX forward the entire used HTTP URL to heimdall.</td></tr></tbody></table></div></div></div></div></div><div class=sect1><h2 id=_integration_with_nginx_ingress_controller>Integration with NGINX Ingress Controller.</h2><div class=sectionbody><div class=paragraph><p>The integration option, described in the <a href=#_second_option>Forward all information in <code>X-Forwarded-*</code> headers</a> section corresponds more or less to the way how the <code>ngnix.conf</code> file is generated by the <a href=https://github.com/kubernetes/ingress-nginx/blob/3c8817f700a4ab1713e3369fc6e5f500b008d989/rootfs/etc/nginx/template/nginx.tmpl#L977>default nginx-ingress template</a> used by the <a href=https://kubernetes.github.io/ingress-nginx/>NGINX Ingress Controller</a>. The only missing things are the request path and the query parameter. So you can easily integrate heimdall using the following config.</p></div><div class=exampleblock><div class=title>Example 4. Possible Configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight" style=color:#fff;background-color:#272822><code data-lang=yaml><span style=color:#a6e22e>ingress</span><span style=color:#fff;background-color:#272822>:</span>
  <span style=color:#a6e22e>enabled</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#66d9ef>true</span>
  <span style=color:#a6e22e>annotations</span><span style=color:#fff;background-color:#272822>:</span>
    <span style=color:#a6e22e>kubernetes.io/ingress.class</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>nginx</span>
    <span style=color:#a6e22e>nginx.ingress.kubernetes.io/auth-url</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>http://heimdall:4456$request_uri&#34;</span> <i class=conum data-value=1></i><b>(1)</b>
    <span style=color:#a6e22e>nginx.ingress.kubernetes.io/auth-response-headers</span><span style=color:#fff;background-color:#272822>:</span> <span style=color:#e6db74>Authorization</span>         <i class=conum data-value=2></i><b>(2)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Configures the controller to pass the request path and query parameters to heimdall’s decision service endpoint.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Let NGINX forward the <code>Authorization</code> header set by heimdall to the upstream service. This configuration depends on
your <a href=../../../docs/configuration/pipeline/hydrators/>Hydrators</a> and <a href=../../../docs/configuration/pipeline/mutators/>Mutators</a> configuration</td></tr></tbody></table></div></div></div></div></div></div><div class="d-flex justify-content-between"><a href=../../../docs/guides/traefik/><div class="fs-6 mb-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-chevron-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5.0 010 .708L5.707 8l5.647 5.646a.5.5.0 01-.708.708l-6-6a.5.5.0 010-.708l6-6a.5.5.0 01.708.0z"/></svg>Traefik Proxy Integration</div></a><a class=ms-auto href=../../../docs/configuration/services/decision_api/><div class="fs-6 mb-3">Decision API<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"/></svg></div></a></div></main></div><footer class="footer py-4 py-md-5 px-4 px-md-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../>Home</a></li><li class=mb-2><a href=../../../>Docs</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../>Install</a></li><li class=mb-2><a href=../../../>Getting Started</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/issues>Issues</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/discussions>Discussions</a></li></ul></div></div></div><script src=../../../js/bundle.min.js defer></script></footer></body></html>