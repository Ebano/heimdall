<!doctype html><html><head><title>Configuration Types</title><meta charset=utf-8><meta name=description content="Website meta description for google search results go here"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../../favicon.ico></head><body><nav class="navbar navbar-expand-lg navbar-light bg-dark fixed-top"><div class=container><a class="navbar-brand text-white" href=../../../../>Heimdall</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class=nav-item><a class='text-white nav-link' href=../../../../docs/introduction/architecture>Docs</a></li><li class=nav-item><a class='text-white nav-link' href=../../../../docs/api/>API</a></li><li class="nav-item dropdown"><a class='text-white nav-link dropdown-toggle' href=# id="Get Started-navbarDropdown" role=button data-bs-toggle=dropdown aria-expanded=false>Get Started</a><ul class=dropdown-menu aria-labelledby="Get Started-navbarDropdown"><li><a class=dropdown-item href=../../../../docs/introduction/install/>Install</a></li><li><a class=dropdown-item href=../../../../docs/introduction/quickstart/>Quickstart</a></li></ul></li></ul><a class=d-flex href=https://github.com/dadrus/heimdall><svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div></div></nav><div id=content class=container><div class=row><div class=col-3><ul class="nav flex-column"><li class=nav-item><span class=nav-link>Introduction</span><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/introduction/architecture/>Architecture</a></li><li class=nav-item><a class=nav-link href=../../../../docs/introduction/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../../docs/introduction/quickstart/>Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/introduction/from_source/>Install from Source</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/>Configuration</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/>Services</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/decision_api/>Decision API</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/proxy/>Proxy</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/>Observability</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/tracing/>Tracing</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/>Pipeline Handler</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/hydrators/>Hydrators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/mutators/>Mutators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/error_handlers/>Error Handlers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/configuration_types/>Configuration Types</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/>Rules</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/default_rule/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/rule_definition/>Rule Definition</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/providers/>Providers</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/reference/>Reference</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/reference/configuration/>Static Configuration</a></li></ul></li></ul></li><li class=nav-item><span class=nav-link>Guides</span><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li></ul></li></ul></div><div class=col-9><h1>Configuration Types</h1><div><h2 id=assertions>Assertions</h2><p>This type enables configuration of required token and claim assertions. Depending on the object type (JWT or introspection response), the assertions apply to different parts of such objects.</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>scopes</code></td><td><em><a href=#scopes-matcher>Scopes Matcher</a></em></td><td>no</td><td>Required scopes given to the client.</td></tr><tr><td><code>audience</code></td><td><em>string array</em></td><td>no</td><td>Required entries in the <code>aud</code> claim. Both cases, either as whitespace separated string, or a JSON array are considered.</td></tr><tr><td><code>issuers</code></td><td><em>string array</em></td><td>yes</td><td>Issuers to trust. At least one issuer must be configured</td></tr><tr><td><code>allowed_algorithms</code></td><td><em>string array</em></td><td>no</td><td>Algorithms, which are trusted (according to <a href=https://datatracker.ietf.org/doc/html/rfc7518>RFC 7518</a>). Defaults to the following list: ES256, ES384, ES512, PS256, PS384, PS512</td></tr><tr><td><code>validity_leeway</code></td><td><em><a href=#duration>Duration</a></em></td><td>yes</td><td>The time leeway to consider while verifying the <code>iat</code>, <code>exp</code> and the <code>nbf</code>.</td></tr></tbody></table><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span><span style=color:#f92672>issuers</span>:
</span></span><span style=display:flex><span> - <span style=color:#ae81ff>foo</span>
</span></span><span style=display:flex><span> - <span style=color:#ae81ff>bar</span>
</span></span><span style=display:flex><span><span style=color:#f92672>audience</span>:
</span></span><span style=display:flex><span> - <span style=color:#ae81ff>zap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>scopes</span>:
</span></span><span style=display:flex><span> - <span style=color:#ae81ff>baz</span>
</span></span><span style=display:flex><span><span style=color:#f92672>allowed_algorithms</span>:
</span></span><span style=display:flex><span> - <span style=color:#ae81ff>ES512</span>
</span></span><span style=display:flex><span><span style=color:#f92672>validity_leeway</span>: <span style=color:#ae81ff>5s</span>
</span></span></code></pre></div><p>Here we say, the token must have been issued either by the issuer <code>foo</code>, or the issuer <code>bar</code>, the <code>aud</code> claim must contain <code>zap</code>, the scope (either <code>scp</code> or <code>scope</code> must be present and contain the scope <code>baz</code>, if the token or the introspection response is signed, it must have been signed by using the <code>ES512</code> algorithm (ECDSA using P-521 and SHA-512) and if the information about token validity is present, we respect a deviation of 5 seconds.</p><h2 id=authentication-data-source>Authentication Data Source</h2><p>An authentication data source is actually a list of possible strategies for subject authentication data retrieval. The entries following the first one are fallbacks and are only executed if the previous strategy could not retrieve the required authentication data from the request.</p><p>This fallback mechanism can become handy, if different clients of your application send the authentication data using different methods. <a href=https://datatracker.ietf.org/doc/html/rfc6750>RFC 6750</a> describes for example how to use bearer tokens in HTTP requests to access OAuth 2.0 protected resources. This RFC says, a token can either be sent in the <code>Authorization</code> header, or in a query parameter, or even as part of the HTTP body. So you can define the following list to let Heimdall try to extract the access token from all three places:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span>- <span style=color:#f92672>header</span>: <span style=color:#ae81ff>Authorization</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>strip_prefix</span>: <span style=color:#ae81ff>Bearer</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>query_parameter</span>: <span style=color:#ae81ff>access_token</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>body_parameter</span>: <span style=color:#ae81ff>access_token</span>
</span></span></code></pre></div><p>The available strategies are described in the following sections.</p><h3 id=cookie-strategy>Cookie Strategy</h3><p>This strategy can retrieve authentication data from a specific HTTP cookie. Following properties are supported:</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>cookie</code></td><td><em>string</em></td><td>yes</td><td>The name of the cookie to use.</td></tr></tbody></table><p><strong>Example</strong></p><p>Imagine you want Heimdall to verify an authentication session, which is represented by a specific cookie before the request hits your upstream service. If the client of your upstream application, which is case of a cookie would usually be a browser sends a cookie named &ldquo;session&rdquo;, you can inform Heimdall to extract and use it by configuring this strategy as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span>- <span style=color:#f92672>cookie</span>: <span style=color:#ae81ff>session</span>
</span></span></code></pre></div><h3 id=header-strategy>Header Strategy</h3><p>This strategy can retrieve authentication data from a specific HTTP header. Following properties are supported:</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>header</code></td><td><em>string</em></td><td>yes</td><td>The name of the header to use.</td></tr><tr><td><code>strip_prefix</code></td><td><em>string</em></td><td>no</td><td>Prefix, which should be stripped from the header value. Stripping the prefix doesn&rsquo;t always make sense. Consider the scopes in which this strategy is applied</td></tr></tbody></table><p><strong>Example</strong></p><p>Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the HTTP <code>Authorization</code> header, you can inform Heimdall to extract it from there by configuring this strategy as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span>- <span style=color:#f92672>header</span>: <span style=color:#ae81ff>Authorization</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>strip_prefix</span>: <span style=color:#ae81ff>Bearer</span>
</span></span></code></pre></div><h3 id=query-parameter-strategy>Query Parameter Strategy</h3><p>This strategy can retrieve authentication data from the query of the request. Following properties are supported:</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>query_parameter</code></td><td><em>string</em></td><td>yes</td><td>The name of the query parameter to use.</td></tr></tbody></table><p><strong>Example</strong></p><p>Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the query parameter named &ldquo;access_token&rdquo;, you can inform Heimdall to extract it from there by configuring this strategy as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span>- <span style=color:#f92672>query_parameter</span>: <span style=color:#ae81ff>access_token</span>
</span></span></code></pre></div><h2 id=authentication-strategy>Authentication Strategy</h2><p>Authentication strategy is kind of abstract type, so you have to define which specific type to use. Each type has its own configuration options.</p><p>An AuthStrategy configuration entry must contain the following two properties:</p><ul><li><code>type</code> - The type of the strategy. Available types are described in the following sections.</li><li><code>config</code> - The strategy specific configuration.</li></ul><p>Available strategies are described in the following sections.</p><h3 id=api-key-strategy>API Key Strategy</h3><p>This strategy can be used if your endpoint expects a specific api key be send in a header or a cookie.</p><p><code>type</code> must be set to <code>api_key</code>. <code>config</code> supports the following properties:</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>in</code></td><td><em>enum</em></td><td>yes</td><td>Where to put the api key. Can be either <code>header</code>, or <code>cookie</code>.</td></tr><tr><td><code>name</code></td><td><em>string</em></td><td>yes</td><td>The name of either the header or the cookie.</td></tr><tr><td><code>value</code></td><td><em>string</em></td><td>yes</td><td>The value of the api key.</td></tr></tbody></table><p><strong>Example</strong></p><p>The following snippet shows how to configure this strategy to send an api key in the <code>X-My-API-Key</code> HTTP header.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>api_key</span>
</span></span><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>in</span>: <span style=color:#ae81ff>header</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>X-My-API-Key</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>value</span>: <span style=color:#ae81ff>super-duper-secret-key</span>
</span></span></code></pre></div><h3 id=basic-auth-strategy>Basic Auth Strategy</h3><p>This strategy can be used if your endpoint is protected by HTTP basic authentication and expects the HTTP <code>Authorization</code> header with required values.</p><p><code>type</code> must be set to <code>basic_auth</code>. <code>config</code> supports the following properties:</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>user</code></td><td><em>string</em></td><td>yes</td><td>The user-id.</td></tr><tr><td><code>password</code></td><td><em>string</em></td><td>yes</td><td>The password.</td></tr></tbody></table><p><strong>Example</strong></p><p>The following snippet shows how to configure this strategy with user set to &ldquo;Alladin&rdquo; and password set to &ldquo;open sesame&rdquo;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>basic_auth</span>
</span></span><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>user</span>: <span style=color:#ae81ff>Alladin</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>open sesame</span>
</span></span></code></pre></div><h3 id=client-credentials-strategy>Client Credentials Strategy</h3><p>This strategy implements the <a href=https://datatracker.ietf.org/doc/html/rfc6749#section-4.4>OAuth2 Client Credentials Grant Flow</a> to obtain an access token expected by the endpoint. Heimdall caches the received access token.</p><p><code>type</code> must be set to <code>client_credentials</code>. <code>config</code> supports the following properties:</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>client_id</code></td><td><em>string</em></td><td>yes</td><td>The client identifier for Heimdall.</td></tr><tr><td><code>client_secret</code></td><td><em>string</em></td><td>yes</td><td>The client secret for Heimdall.</td></tr><tr><td><code>scopes</code></td><td><em>string array</em></td><td>no</td><td>The scopes required for the access token.</td></tr><tr><td><code>token_url</code></td><td><em>string</em></td><td>yes</td><td>The token endpoint of the authorization server.</td></tr></tbody></table><p><strong>Example</strong></p><p>The following snippet shows how to configure this strategy</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>client_credentials</span>
</span></span><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>token_url</span>: <span style=color:#ae81ff>https://my-auth.provider/token</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>client_id</span>: <span style=color:#ae81ff>foo</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>client_secret</span>: <span style=color:#ae81ff>bar</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>scopes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>baz</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>zap</span>
</span></span></code></pre></div><h2 id=duration>Duration</h2><p>Duration is actually a string type, which adheres to the following pattern: <code>^[0-9]+(ns|us|ms|s|m|h)$</code></p><p>So with <code>10s</code> you can define the duration of 10 seconds and with <code>2h</code> you can say 2 hours.</p><h2 id=endpoint>Endpoint</h2><p>The Endpoint type defines properties required for the communication with an endpoint.</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>url</code></td><td><em>string</em></td><td>yes</td><td>the actual url of the endpoint</td></tr><tr><td><code>method</code></td><td><em>string</em></td><td>no</td><td>the HTTP method to use while communicating with the endpoint. If not set <code>POST</code> is used.</td></tr><tr><td><code>retry</code></td><td><em><a href=#retry>Retry</a></em></td><td>no</td><td>what to do if the communication fails. If not configured, no retry attempts are done.</td></tr><tr><td><code>auth</code></td><td><em><a href=#authentication-strategy>Authentication Strategy</a></em></td><td>no</td><td>authentication strategy to apply, if the endpoint requires authentication.</td></tr><tr><td><code>headers</code></td><td><em>Map of strings</em></td><td>no</td><td>HTTP headers to be send to the endpoint</td></tr></tbody></table><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span><span style=color:#f92672>endpoint</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span>: <span style=color:#ae81ff>http://foo.bar</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>method</span>: <span style=color:#ae81ff>GET</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>retry</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>give_up_after</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>max_delay</span>: <span style=color:#ae81ff>1s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>auth</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>api_key</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>foo</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>value</span>: <span style=color:#ae81ff>bar</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>in</span>: <span style=color:#ae81ff>cookie</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>headers</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>X-My-First-Header</span>: <span style=color:#ae81ff>foobar</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>X-My-Second-Header</span>: <span style=color:#ae81ff>barfoo</span>
</span></span></code></pre></div><h2 id=error-condition>Error Condition</h2><p>This type supports definition of conditions, under which an error handler should execute its logic. Such conditions are required for all error handlers, but the default one. Each entry element in a condition is evaluated using boolean <code>and</code>.</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>error</code></td><td><em><a href=#error-type>Error Type</a> array</em></td><td>yes</td><td>A list with error types to match. Each entry is evaluated using a boolean <code>or</code> logic.</td></tr><tr><td><code>request_cidr</code></td><td><em>string array</em></td><td>no</td><td>A list with CIDR entries to match. Each entry is evaluated using a boolean <code>or</code> logic.</td></tr><tr><td><code>request_headers</code></td><td><em>string array map</em></td><td>no</td><td>A map with header names and the corresponding values to match. Each entry is evaluated using a boolean <code>or</code> logic. This holds also true for the header values.</td></tr></tbody></table><p><strong>Example 1</strong></p><p>This example shows in principle all possible combinations. The actual values and the amount of them will for sure differ in your particular case. However, for showing the idea, the complexity of this example is enough.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>error</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>precondition_error</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># OR</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>authorization_error</span>
</span></span><span style=display:flex><span><span style=color:#75715e># AND</span>
</span></span><span style=display:flex><span><span style=color:#f92672>request_cidr</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>192.168.0.0</span><span style=color:#ae81ff>/16</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># OR</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>10.0.0.0</span><span style=color:#ae81ff>/8</span>
</span></span><span style=display:flex><span><span style=color:#75715e># AND</span>
</span></span><span style=display:flex><span><span style=color:#f92672>request_headers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Accept</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>text/html</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># OR</span>
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#34;*/*&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># OR</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Content-Type</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>application/json</span>
</span></span></code></pre></div><p>This condition evaluates to true only if all parts of it (<code>error</code>, <code>request_cidr</code>, <code>request_headers</code>) evaluate to true. With</p><ul><li><code>error</code> evaluates to true, if the encountered error was either <code>precondition_error</code> or <code>authorization_error</code>.</li><li><code>request_cidr</code> evaluates to true, if the request came from an IP in either <code>192.168.0.0/16</code> or <code>10.0.0.0/8</code> range. And</li><li><code>request_headers</code> evaluates to true, if either the HTTP <code>Accept</code> header contains one of <code>text/html</code>, or <code>*/*</code>, or the HTTP <code>Contet-Type</code> header contains <code>application/json</code>.</li></ul><p><strong>Example 2</strong></p><p>This example is a very simple one, showing just the usage of the <code>error</code> attribute:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>error</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>authentication_error</span>
</span></span></code></pre></div><p>This condition evaluate to true, if the encountered error was <code>authentication_error</code>.</p><h2 id=error-type>Error Type</h2><p>Heimdall defines a couple of error types, which it uses to signal errors. Some of them are available for configuring your <a href=#error-condition>Error Condition</a>s.</p><p>Following types are available:</p><ul><li><code>authentication_error</code> - used if an authenticator failed to verify authentication data available in the request. E.g. an authenticator was configured to verify a JWT and the signature of it was invalid.</li><li><code>authorization_error</code> - used if an authorizer failed to authorize the subject. E.g. an authorizer is configured to use a script to execute on the given subject and request context, but this script returned with an error.</li><li><code>internal_error</code> - used if Heimdall run into an internal error condition while processing the request. E.g. something went wrong while unmarshalling a JSON object, or if there was a configuration error, which couldn&rsquo;t be raised while loading a rule, etc.</li><li><code>precondition_error</code> - used if the request does not contain required/expected data. E.g. if an authenticator could not find a cookie configured.</li></ul><h2 id=retry>Retry</h2><p>Implements an exponential backoff strategy for endpoint communication. It increases the backoff exponentially by multiplying the <code>max_delay</code> with 2^(attempt count)</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>give_up_after</code></td><td><em><a href=#duration>Duration</a></em></td><td>no</td><td>sets an upper bound on the maximum time to wait between two requests. Default to 0, which means no upper bound</td></tr><tr><td><code>max_delay</code></td><td><em><a href=#duration>Duration</a></em></td><td>yes</td><td>the initial backoff.</td></tr></tbody></table><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span><span style=color:#f92672>retry</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>give_up_after</span>: <span style=color:#ae81ff>60s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>max_delay</span>: <span style=color:#ae81ff>1s</span>
</span></span></code></pre></div><p>In this example the backoff will be 1, 2, 4, 8, 16, 32, 60, &mldr;</p><h2 id=scopes-matcher>Scopes Matcher</h2><p>Scopes matcher is a configuration type allowing configuration of different strategies to match required scopes. In its simplest shape it can be just an array of strings (implemented by the <a href=#exact>Exact</a>) scope mtcher. To cover many use cases, different strategies are available and described in the following sections.</p><p>Regardless of the strategy, each matcher can explicitly be configured and supports the following configuration properties:</p><ul><li><code>matching_strategy</code> - the type of the mathing strategy.</li><li><code>values</code> - the list of scope patterns</li></ul><h3 id=exact>Exact</h3><p>This the simplest matcher and is automatically selected, if just an array of strings is configured as shown in the following snippet:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ae81ff>foo</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>bar</span>
</span></span></code></pre></div><p>However, as written in the <a href=#scopes-matcher>Scopes Matcher</a> section, it can also explicitly be selected by setting <code>matching_strategy</code> to <code>exact</code> and defining the required scopes in the <code>values</code> property.</p><p><strong>Example</strong></p><p>The following two configurations are essentially the same:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>matching_strategy</span>: <span style=color:#ae81ff>exact</span>
</span></span><span style=display:flex><span><span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>foo</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>bar</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  - <span style=color:#ae81ff>foo</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>bar</span>
</span></span></code></pre></div><h3 id=hierarchic>Hierarchic</h3><p>This matcher enables matching hierarchical scopes, which use <code>.</code> as separator. Imagine your system is organized that way, that it defines namespaces for different services like this:</p><ul><li><code>my-service</code> being the top namespace</li><li><code>my-service.booking</code> - being the namespace of the booking service</li><li><code>my-service.orders</code> - being the namespace of the orders service</li><li><code>my-service.orders.partners</code> - being the namespace of the order service for partners and</li><li><code>my-service.orders.customers</code> - being the namespace of the order service for customers</li></ul><p>Basically you&rsquo;ve established an identity for each of your services (this is comparable to how <a href=https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-id>SPIFFE IDs</a> are organized and also used for).</p><p>Now, imagine you use these namespaces as scope values to limit the usage of the issued tokens. In such situations the hierarchic scope matcher can become handy if you would like to assert any scope of the token must be in e.g. the <code>my-service</code> or the <code>my-service.orders</code> namespace.</p><p>This matcher can only be used by explicitly setting the <code>matching_strategy</code> to <code>hierarchic</code> and defining the required patterns in the <code>values</code> property.</p><p><strong>Example 1</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>matching_strategy</span>: <span style=color:#ae81ff>hierarchic</span>
</span></span><span style=display:flex><span><span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>my-service</span>
</span></span></code></pre></div><p>This configuration will ensure all scopes withing the scope or scp claim are within the <code>my-service</code> namespace. So scope claim like</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scope&#34;</span>: [<span style=color:#e6db74>&#34;my-service.orders&#34;</span>, <span style=color:#e6db74>&#34;my-service.orders.customers&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>would match, but</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scope&#34;</span>: [<span style=color:#e6db74>&#34;not-my-service&#34;</span>, <span style=color:#e6db74>&#34;my-service.orders.customers&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>would not match.</p><h3 id=wildcard>Wildcard</h3><p>This matcher enables matching scopes using wildcards. It goes beyond the <a href=#hierarchic>Hierarchic</a> scope matcher by enabling usage of wildcards.</p><p>This matcher can only be used by explicitly setting the <code>matching_strategy</code> to <code>wildcard</code> and defining the required patterns in the <code>values</code> property.</p><h2 id=session>Session</h2><p>This configuration type enables extraction of subject information from responses received by Heimdall from authentication services. Following properties are available.</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td><code>subject_id_from</code></td><td>string</td><td>yes</td><td>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the id of the subject in the JSON object</td></tr><tr><td><code>subject_attributes_from</code></td><td>string</td><td>no</td><td>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the attributes of the subject in the JSON object. Defaults to <code>@this</code></td></tr></tbody></table><p><strong>Example 1</strong></p><p>This example shows how to extract the subject id from an <a href=https://tools.ietf.org/html/rfc7662>OAuth2 Introspection</a> endpoint response and set the subject attributes to the entire response</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span><span style=color:#f92672>subject_id_from</span>: <span style=color:#ae81ff>sub</span>
</span></span><span style=display:flex><span><span style=color:#f92672>subject_attributes_from</span>: @<span style=color:#ae81ff>this</span>
</span></span></code></pre></div><p>Setting <code>subject_attributes_from</code> was actually not required, as <code>@this</code> would be set by default anyway.</p><p><strong>Example 2</strong></p><p>This example shows how to extract the subject id from an <a href=https://www.ory.sh/docs/kratos/>Ory Kratos</a> &ldquo;whoami&rdquo; endpoint response and set the subject attributes to the entire response. <code>subject_attributes_from</code> is not configured, so default is used.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.yaml data-lang=.yaml><span style=display:flex><span><span style=color:#f92672>subject_id_from</span>: <span style=color:#ae81ff>identity.id</span>
</span></span></code></pre></div></div></div></div></div><footer class="footer py-4 py-md-5 px-4 px-md-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../>Home</a></li><li class=mb-2><a href=../../../../>Docs</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../>Install</a></li><li class=mb-2><a href=../../../../>Getting Started</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/issues>Issues</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/discussions>Discussions</a></li></ul></div></div></div><script src=../../../../js/bundle.min.js defer></script></footer></body></html>