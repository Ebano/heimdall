<!doctype html><html><head><title>Error Handlers</title><meta charset=utf-8><meta name=description content="Website meta description for google search results go here"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../../favicon.ico></head><body><nav class="navbar navbar-expand-lg navbar-light bg-dark fixed-top"><div class=container><a class="navbar-brand text-white" href=https://dadrus.github.io/>Heimdall</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class=nav-item><a class='text-white nav-link' href=https://dadrus.github.io/docs/introduction/architecture>Docs</a></li><li class=nav-item><a class='text-white nav-link' href=https://dadrus.github.io/docs/api/>API</a></li><li class="nav-item dropdown"><a class='text-white nav-link dropdown-toggle' href=# id="Get Started-navbarDropdown" role=button data-bs-toggle=dropdown aria-expanded=false>Get Started</a><ul class=dropdown-menu aria-labelledby="Get Started-navbarDropdown"><li><a class=dropdown-item href=../../../../docs/introduction/install/>Install</a></li><li><a class=dropdown-item href=../../../../docs/introduction/quickstart/>Quickstart</a></li></ul></li></ul><a class=d-flex href=https://github.com/dadrus/heimdall><svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div></div></nav><div id=content class=container><div class=row><div class=col-3><ul class="nav flex-column"><li class=nav-item><span class=nav-link>Introduction</span><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/introduction/architecture/>Architecture</a></li><li class=nav-item><a class=nav-link href=../../../../docs/introduction/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../../docs/introduction/quickstart/>Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/introduction/from_source/>Install from Source</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/>Configuration</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/decision_api/>Decision API</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/proxy/>Proxy</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/tracing/>Tracing</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/>Pipeline</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/hydrators/>Hydrators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/mutators/>Mutators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/error_handlers/>Error Handlers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/configuration_types/>Configuration Types</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/>Rules</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/default/>Default</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/providers/>Providers</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/reference/>Reference</a></li></ul></li><li class=nav-item><span class=nav-link>Guides</span><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li></ul></li></ul></div><div class=col-9><h1>Error Handlers</h1><div><p>Error Handlers are responsible for execution of logic if any of the handlers <a href=https://dadrus.github.io/docs/configuration/pipeline/authenticators/>authenticators</a>, <a href=https://dadrus.github.io/docs/configuration/pipeline/authorizers/>authorizers</a>, <a href=https://dadrus.github.io/docs/configuration/pipeline/hydrators/>hydrators</a> or <a href=https://dadrus.github.io/docs/configuration/pipeline/mutators/>mutators</a> fail. The error handlers range from a simple error response to the client which sent the request to sophisticated handlers supporting complex logic and redirects.</p><p>The following section describes the available error handler types in more detail.</p><h2 id=error-handler-types>Error Handler Types</h2><h3 id=default>Default</h3><p>This error handler is always there and is executed if no other error handler is responsible for the handling of an error. Actually, there is no need to explicitly configure it. The only exception is to allow overriding the <a href=https://dadrus.github.io/docs/configuration/rules/#default-rule>default rule</a>&rsquo;s error handler chain in a rule for performance reasons (if configured error handlers in the default rule should not be considered). This error handler type doesn&rsquo;t have any configuration options.</p><p>To enable the usage of this error handler, you have to set the <code>type</code> property to <code>default</code>.</p><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>id</span>: <span style=color:#ae81ff>foo</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>default</span>
</span></span></code></pre></div><h3 id=redirect>Redirect</h3><p>This error handler allows to redirect the client to another endpoint, e.g. to let the user authenticate. Technically this error handler returns e.g. a HTTP <code>302 Found</code> response code and sets the HTTP <code>Location</code> header.</p><p>To enable the usage of this hydrator, you have to set the <code>type</code> property to <code>redirect</code>.</p><p>Configuration using the <code>config</code> property is mandatory. Following properties are available:</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Overridable</th><th>Description</th></tr></thead><tbody><tr><td><code>to</code></td><td><em>URL</em></td><td>yes</td><td>no</td><td>The url to redirect the client to. If no <code>return_to_query_parameter</code> is defined, the value of the HTTP <code>Location</code> hader is set to the configured value.</td></tr><tr><td><code>return_to_query_parameter</code></td><td><em>string</em></td><td>no</td><td>no</td><td>If you want to return the user back to the url, Heimdall was handling when this error handler kicked in and your authentication system supports this by considering a specific query parameter, you can configure it here.</td></tr><tr><td><code>code</code></td><td><em>int</em></td><td>no</td><td>no</td><td>The code to be used for the redirect. Defaults to <code>302 Found</code>. Heimdall does not check the configured code for HTTP redirect validity!</td></tr><tr><td><code>when</code></td><td><em><a href=https://dadrus.github.io/docs/configuration/pipeline/configuration_types/#error-condition>Error Condition</a> array</em></td><td>yes</td><td>yes</td><td>Conditions, which must hold true for this error handler to execute. The defined conditions are evaluated using a boolean or. So at least one of the defined conditions must evaluate to <code>true</code> to have this error handler executed.</td></tr></tbody></table><p><strong>Example</strong></p><p>The redirect error handler below is configured to kick in if either</p><ul><li>a first error condition evaluates to true. This condition is for web requests (HTTP <code>Accept</code> header contains <code>text/html</code>) if an <code>authentication_error</code> error occurred (an error raised by authenticators). In this case, it will redirect the client (for web requests, usually a browser) to <code>http://127.0.0.1:4433/self-service/login/browser</code> and also add the <code>return_to</code> query parameter with the current url to the redirect url.</li><li>Or if a second condition evaluates to true. The only difference to the previous one is the error type, which is <code>authorization_error</code> in this case.</li></ul><p>So, e.g. if Heimdall was handling the request for <code>http://my-service.local/foo</code> and run into an error like described above, the value of the HTTP <code>Location</code> header will be set to <code>http://127.0.0.1:4433/self-service/login/browser?return_to=http%3A%2F%2Fmy-service.local%2Ffoo</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>id</span>: <span style=color:#ae81ff>authenticate_with_kratos</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>redirect</span>
</span></span><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>to</span>: <span style=color:#ae81ff>http://127.0.0.1:4433/self-service/login/browser</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>return_to_query_parameter</span>: <span style=color:#ae81ff>return_to</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>when</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>error</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>authentication_error</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>request_headers</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>Accept</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>text/html</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>error</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>authorization_error</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>request_headers</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>Accept</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>text/html</span>
</span></span></code></pre></div><p>In this case the error condition can actually be simplified, so the error handler configuration can look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>id</span>: <span style=color:#ae81ff>authenticate_with_kratos</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>redirect</span>
</span></span><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>to</span>: <span style=color:#ae81ff>http://127.0.0.1:4433/self-service/login/browser</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>return_to_query_parameter</span>: <span style=color:#ae81ff>return_to</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>when</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>error</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>authentication_error</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>authorization_error</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>request_headers</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>Accept</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>text/html</span>
</span></span></code></pre></div><h3 id=www-authenticate>WWW-Authenticate</h3><p>This error handler responds with HTTP <code>401 Unauthorized</code> and a <code>WWW-Authenticate</code> HTTP header set. As of now, this error handler is the only one error handler, which transforms Heimdall into an authentication system, a very simple one though ;). By configuring this error handler you can implement the <a href=https://datatracker.ietf.org/doc/html/rfc7617>Basic HTTP Authentication Scheme</a> by also making use of the <a href=https://dadrus.github.io/docs/configuration/pipeline/authenticators/#basic-auth>Basic Auth</a> authenticator. Without that authenticator, the usage of this error handler does actually not make any sense.</p><p>To enable the usage of this hydrator, you have to set the <code>type</code> property to <code>www_authenticate</code>.</p><p>Configuration using the <code>config</code> property is mandatory. Following properties are available:</p><table><thead><tr><th>Name</th><th>Type</th><th>Mandatory</th><th>Overridable</th><th>Description</th></tr></thead><tbody><tr><td><code>realm</code></td><td><em>string</em></td><td>no</td><td>yes</td><td>The &ldquo;realm&rdquo; according to <a href=https://datatracker.ietf.org/doc/html/rfc7235#section-2.2>RFC 7235, section 2.2</a>. Defaults to &ldquo;Please authenticate&rdquo;.</td></tr><tr><td><code>when</code></td><td><strong><a href=https://dadrus.github.io/docs/configuration/pipeline/configuration_types/#error-condition>Error Condition</a> array</strong></td><td>yes</td><td>yes</td><td>Conditions, which must hold true for this error handler to execute. The defined conditions are evaluated using a boolean or. So at least one of the defined conditions must evaluate to <code>true</code> to have this error handler executed.</td></tr></tbody></table><p><strong>Example</strong></p><p>The www authenticate error handler below is configured to kick in for web requests (HTTP <code>Accept</code> header contains <code>text/html</code>) if an <code>authentication_error</code> error occurred (an error raised by authenticators). In this case, it will respond with HTTP <code>401 Unauthorized</code> and a <code>WWW-Authenticate</code> header set to <code>Basic realm="My fancy app"</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>id</span>: <span style=color:#ae81ff>basic_authenticate</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>www_authenticate</span>
</span></span><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>realm</span>: <span style=color:#e6db74>&#34;My fancy app&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>when</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>error</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>authentication_error</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>request_headers</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>Accept</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>text/html</span>
</span></span></code></pre></div></div></div></div></div><footer class="footer py-4 py-md-5 px-4 px-md-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../>Home</a></li><li class=mb-2><a href=../../../../>Docs</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../>Install</a></li><li class=mb-2><a href=../../../../>Getting Started</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/issues>Issues</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/discussions>Discussions</a></li></ul></div></div></div><script src=../../../../js/bundle.min.js defer></script></footer></body></html>