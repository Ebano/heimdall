<!doctype html><html><head><title>Decision API</title><meta charset=utf-8><meta name=description content="Website meta description for google search results go here"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../../favicon.ico></head><body><nav class="navbar navbar-expand-lg navbar-light bg-dark fixed-top"><div class=container><a class="navbar-brand text-white" href=../../../../>Heimdall</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class=nav-item><a class='text-white nav-link' href=../../../../docs/introduction/architecture>Docs</a></li><li class=nav-item><a class='text-white nav-link' href=../../../../docs/api/>API</a></li><li class="nav-item dropdown"><a class='text-white nav-link dropdown-toggle' href=# id="Get Started-navbarDropdown" role=button data-bs-toggle=dropdown aria-expanded=false>Get Started</a><ul class=dropdown-menu aria-labelledby="Get Started-navbarDropdown"><li><a class=dropdown-item href=../../../../docs/introduction/install/>Install</a></li><li><a class=dropdown-item href=../../../../docs/introduction/quickstart/>Quickstart</a></li></ul></li></ul><a class=d-flex href=https://github.com/dadrus/heimdall><svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div></div></nav><div id=content class=container><div class=row><div class=col-3><ul class="nav flex-column"><li class=nav-item><span class=nav-link>Introduction</span><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/introduction/architecture/>Architecture</a></li><li class=nav-item><a class=nav-link href=../../../../docs/introduction/install/>Install</a></li><li class=nav-item><a class=nav-link href=../../../../docs/introduction/quickstart/>Quickstart</a></li><li class=nav-item><a class=nav-link href=../../../../docs/introduction/from_source/>Install from Source</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/>Configuration</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/>Services</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/decision_api/>Decision API</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/services/proxy/>Proxy</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/>Observability</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/logging/>Logging</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/metrics/>Metrics</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/observability/tracing/>Tracing</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/>Pipeline Handler</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authenticators/>Authenticators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/authorizers/>Authorizers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/hydrators/>Hydrators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/mutators/>Mutators</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/error_handlers/>Error Handlers</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/pipeline/configuration_types/>Configuration Types</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/>Rules</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/default_rule/>Default Rule</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/rule_definition/>Rule Definition</a></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/rules/providers/>Providers</a></li></ul></li><li class=nav-item><a class=nav-link href=../../../../docs/configuration/reference/>Reference</a><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/configuration/reference/configuration/>Static Configuration</a></li></ul></li></ul></li><li class=nav-item><span class=nav-link>Guides</span><ul class="nav flex-column"><li class=nav-item><a class=nav-link href=../../../../docs/guides/traefik/>Traefik Proxy Integration</a></li></ul></li></ul></div><div class=col-9><h1>Decision API</h1><div><p>Decision API is one of the operating modes supported by Heimdall, used if you start Heimdall with <code>heimdall serve api</code>. By default, Heimdall listens on <code>0.0.0.0:4456/decisions</code> endpoint for incoming requests in this mode of operation and also configures useful default timeouts. No other options are configured. You can, and should however adjust the configuration for your needs.</p><h2 id=configuration>Configuration</h2><p>The configuration for the Decision API can be adjusted in the <code>api</code> property of heimdall&rsquo;s configuration and supports following properties.</p><h3 id=host>Host</h3><p>By making use of the <code>host</code> (<em>string</em>) property, you can specify the TCP/IP address on which heimdall should listen for connections from client applications. The entry <code>0.0.0.0</code> allows listening for all IPv4 addresses. <code>0.0.0.0</code> is also the default setting.</p><p><strong>Example</strong></p><p>In this example, we configure heimdall to allow only local TCP/IP “loopback” connections to be made. Makes actually only sense, if your reverse proxy/gateway, which communicates with Heimdall, runs on the same machine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>: <span style=color:#ae81ff>127.0.0.1</span>
</span></span></code></pre></div><h3 id=port>Port</h3><p>By making use of the <code>port</code> (<em>integer</em>) property, you can specify the TCP port the heimdall should listen on. Defaults to <code>4456</code>.</p><p><strong>Example</strong></p><p>In this example, we configure heimdall to listen on port <code>4444</code> for Decision API requests.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>4444</span>
</span></span></code></pre></div><h3 id=verbose-errors>Verbose Errors</h3><p>By making use of <code>verbose_errors</code> (<em>boolean</em>) you can instruct Heimdall&rsquo;s default error handler to preserve error information and provide it in the response body to the caller. Defaults to <code>false</code>.</p><p>Heimdall supports MIME type negotiation. So, if your reverse proxy/gateway sets the HTTP <code>Accept</code> header to e.g. <code>application/json</code>, and Heimdall run into an unhandled internal error condition, in addition to responding with <code>500 Internal Server Error</code>, it will render an error message, like shown below, if <code>verbose_errors</code> has been set to <code>true</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;code&#34;</span>: <span style=color:#e6db74>&#34;internalServerError&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;whatever led to the error&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>message</code> will however contain just high-level information, like &ldquo;failed to parse something&rdquo;, but will not contain any stack traces.</p><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>verbose_errors</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><h3 id=timeout>Timeout</h3><p>Like written above, Heimdall configures useful timeout defaults. You can however override this by making use of the <code>timeout</code> option and specifying the timeouts, you need. Following configuration options are supported:</p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>read</code></td><td><em><a href=#duration>Duration</a></em></td><td>The amount of time allowed to read the full request including body. Defaults to 5 seconds.</td></tr><tr><td><code>write</code></td><td><em><a href=#duration>Duration</a></em></td><td>The maximum duration before timing out writes of the response. Defaults to 10 seconds</td></tr><tr><td><code>idle</code></td><td><em><a href=#duration>Duration</a></em></td><td>The maximum amount of time to wait for the next request when keep-alive is enabled. If <code>ìdle</code> is <code>0</code>, the value of <code>read</code> timeout is used. Defaults to 2 minutes.</td></tr></tbody></table><p><strong>Example</strong></p><p>In this example, we are setting the read timeout to 1 second, write timeout to 2 seconds and the idle timeout to 1 minute.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>timeout</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>read</span>: <span style=color:#ae81ff>1s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>write</span>: <span style=color:#ae81ff>2s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>idle</span>: <span style=color:#ae81ff>1m</span>
</span></span></code></pre></div><h3 id=cors>CORS</h3><p><a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS>CORS</a> (Cross-Origin Resource Sharing) headers can be added and configured by making use of the <code>cors</code> option. This functionality allows for advanced security features to quickly be set. If CORS headers are set, then the Heimdall does not pass preflight requests to its decision pipeline, instead the response will be generated and sent back to the client directly. Following configuration options are supported:</p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>allowed_origins</code></td><td><em>string array</em></td><td>List of origins that may access the resource. Defaults to all, if not set, but any of the other CORS options are configured.</td></tr><tr><td><code>allowed_methods</code></td><td><em>string array</em></td><td>List of methods allowed when accessing the resource. This is used in response to a preflight request. Defaults to <code>GET</code>, <code>POST</code>, <code>HEAD</code>, <code>PUT</code>, <code>DELETE</code>, <code>PATCH</code> if not set, but any of the other CORS options are configured.</td></tr><tr><td><code>allowed_headers</code></td><td><em>string array</em></td><td>List of request headers that can be used when making the actual request.</td></tr><tr><td><code>exposed_headers</code></td><td><em>string array</em></td><td>&ldquo;Allow-List&rdquo; of headers that clients are allowed to access.</td></tr><tr><td><code>allow_credentials</code></td><td><em>boolean</em></td><td>Indicates whether or not the response to the request can be exposed when the credentials flag is true. When used as part of a response to a preflight request, this indicates whether or not the actual request can be made using credentials. Defaults to <code>false</code> if not set, but any of the other CORS options are configured.</td></tr><tr><td><code>max_age</code></td><td><em><a href=#duration>Duration</a></em></td><td>Indicates how long the results of a preflight request can be cached. Defaults to 0 seconds if not set, but any of the other CORS options are configured.</td></tr></tbody></table><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>cors</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>allowed_origins</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>example.org</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>allowed_methods</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>HEAD</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PATCH</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>allow_credentials</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>max_age</span>: <span style=color:#ae81ff>10s</span>
</span></span></code></pre></div><h3 id=tls>TLS</h3><p>By default, the Decision API accepts HTTP requests. Depending on your deployment scenario, you could require Heimdall to accept HTTPS requests only. You can do so by making use of the <code>tls</code> option.</p><p>As of today, the available configuration options are however limited to setting up the private key, as well as the corresponding certificate. TLSv1.2 and TLSv1.3 can however be used by the Decision API client. TLSv1.2 cipher spec usage is however limited to what the Go Language supports.</p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>key</code></td><td><em>string</em></td><td>Path to the private key in PEM format. PKCS#1, as well as PKCS#8 formats are supported.</td></tr><tr><td><code>cert</code></td><td><em>string</em></td><td>Path to the certificate in PEM format. The certificate file may contain intermediate certificates following the leaf certificate to form a certificate chain</td></tr></tbody></table><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>/path/to/private_key.pem</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cert</span>: <span style=color:#ae81ff>/path/to/certificate.pem</span>
</span></span></code></pre></div><h3 id=trusted-proxies>Trusted Proxies</h3><p>The usage of the Decision API makes only sense, if operated behind some sort of proxy, like API Gateway, etc. In such cases certain header information may be sent to Heimdall using special <code>X-Forwarded-*</code> headers or the <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Forwarded>Forwarded</a> header. For example, the <code>Host</code> HTTP header is usually used to return the requested host. But when you’re behind a proxy, the actual host may be stored in an <code>X-Forwarded-Host</code> header, which could, however, also be spoofed.</p><p>To prevent header spoofing and allowing such headers to be accepted from trusted proxies only (so the systems, you have configured to make use of Heimdall&rsquo;s Decision API), you should configure the <code>trusted_proxies</code> (<em>string array</em>) option and list the IPs, or IP ranges (CIDR notation) of your proxies, which make use of Heimdall&rsquo;s Decision API. If not configured, Heimdall will accept those headers from any client.</p><p>If you configure <code>trusted_proxies</code> to an empty list, Heimdall will not make use of any headers that could be spoofed. This would usually be the configuration for proxies, which do not send information about the client request in headers, but use the corresponding HTTP scheme, method, path, etc, while communicating with Heimdall (e.g. Nginx). If you put Heimdall behind e.g. Traefik, which forwards this information in <code>X-Forwarded-*</code> headers, you should configure the <code>trusted_proxies</code> list to contain the addresses of your Traefik instances only.</p><p><strong>Example 1</strong></p><p>Disable usage of any headers, which could be spoofed for all clients</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>trusted_proxies</span>: []
</span></span></code></pre></div><p><strong>Example 2</strong></p><p>Disable usage of any headers, which could be spoofed for all clients, except those listed in the configuration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>trusted_proxies</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>192.168.2.15</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>192.168.2.16</span> 
</span></span></code></pre></div><p><strong>Example 3</strong></p><p>Disable usage of any headers, which could be spoofed for all clients, except those which are within the configured IP range.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>trusted_proxies</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>192.168.2.0</span><span style=color:#ae81ff>/24</span>
</span></span></code></pre></div><h3 id=common-configuration-types>Common Configuration Types</h3><h4 id=duration>Duration</h4><p>Duration is actually a string type, which adheres to the following pattern: <code>^[0-9]+(ns|us|ms|s|m|h)$</code></p><p>So with <code>10s</code> you can define the duration of 10 seconds and with <code>2h</code> you can say 2 hours.</p></div><p class="small text-muted fst-italic text-end">Last updated on <time class=fw-bold>06/20/2022</time> by Dimitrij Drus</p></div></div></div><footer class="footer py-4 py-md-5 px-4 px-md-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../>Home</a></li><li class=mb-2><a href=../../../../>Docs</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../../>Install</a></li><li class=mb-2><a href=../../../../>Getting Started</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/issues>Issues</a></li><li class=mb-2><a href=https://github.com/dadrus/heimdall/discussions>Discussions</a></li></ul></div></div></div><script src=../../../../js/bundle.min.js defer></script></footer></body></html>